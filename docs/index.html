<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.7.0"/>
    <title>skeletor API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

            <h2>Contents</h2>
            <ul>
  <li><a href="#what-is-skeletor">What is skeletor?</a></li>
  <li><a href="#installation">Installation</a></li>
  <li><a href="#getting-started">Getting started</a></li>
  <li><a href="#examples">Examples</a></li>
  <li><a href="#gotchas">Gotchas</a></li>
  <li><a href="#benchmarks">Benchmarks</a></li>
  <li><a href="#what-about-algorithm-x">What about algorithm <code>X</code>?</a></li>
  <li><a href="#references">References</a></li>
  <li><a href="#top-level-functions-and-classes">Top-level functions and classes</a></li>
</ul>


            <h2>Submodules</h2>
            <ul>
                    <li><a href="skeletor/pre.html">pre</a></li>
                    <li><a href="skeletor/post.html">post</a></li>
                    <li><a href="skeletor/skeletonize.html">skeletonize</a></li>
            </ul>

            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Skeleton">Skeleton</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Skeleton.__init__">Skeleton</a>
                        </li>
                        <li>
                                <a class="variable" href="#Skeleton.swc">swc</a>
                        </li>
                        <li>
                                <a class="variable" href="#Skeleton.mesh">mesh</a>
                        </li>
                        <li>
                                <a class="variable" href="#Skeleton.mesh_map">mesh_map</a>
                        </li>
                        <li>
                                <a class="variable" href="#Skeleton.method">method</a>
                        </li>
                        <li>
                                <a class="variable" href="#Skeleton.edges">edges</a>
                        </li>
                        <li>
                                <a class="variable" href="#Skeleton.vertices">vertices</a>
                        </li>
                        <li>
                                <a class="variable" href="#Skeleton.radius">radius</a>
                        </li>
                        <li>
                                <a class="variable" href="#Skeleton.skeleton">skeleton</a>
                        </li>
                        <li>
                                <a class="variable" href="#Skeleton.skel_map">skel_map</a>
                        </li>
                        <li>
                                <a class="variable" href="#Skeleton.roots">roots</a>
                        </li>
                        <li>
                                <a class="variable" href="#Skeleton.leafs">leafs</a>
                        </li>
                        <li>
                                <a class="function" href="#Skeleton.reindex">reindex</a>
                        </li>
                        <li>
                                <a class="function" href="#Skeleton.reroot">reroot</a>
                        </li>
                        <li>
                                <a class="function" href="#Skeleton.copy">copy</a>
                        </li>
                        <li>
                                <a class="function" href="#Skeleton.get_graph">get_graph</a>
                        </li>
                        <li>
                                <a class="function" href="#Skeleton.get_segments">get_segments</a>
                        </li>
                        <li>
                                <a class="function" href="#Skeleton.save_swc">save_swc</a>
                        </li>
                        <li>
                                <a class="function" href="#Skeleton.scene">scene</a>
                        </li>
                        <li>
                                <a class="function" href="#Skeleton.show">show</a>
                        </li>
                        <li>
                                <a class="function" href="#Skeleton.mend_breaks">mend_breaks</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#example_mesh">example_mesh</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
skeletor    </h1>

                        <div class="docstring"><h1 id="what-is-skeletor">What is skeletor?</h1>

<p>Unlike its <a href="https://en.wikipedia.org/wiki/Skeletor">namesake</a>, this <code><a href="">skeletor</a></code>
does not (yet) seek to conquer Eternia but to turn meshes into skeletons.</p>

<p>Before we get started some terminology:</p>

<ul>
<li>a <em>mesh</em> is something that consists of <em>vertices</em> and <em>faces</em></li>
<li>a <em>skeleton</em> is a (hierarchical) tree-like structure consisting of <em>vertices</em>
(also called <em>nodes</em>) and <em>edges</em> that connect them</li>
</ul>

<p>Skeletons are useful for a range of reasons. For example:</p>

<ol>
<li>Typically smaller (less vertices) than the mesh</li>
<li>Have an implicit sense of topology (e.g. "this node is distal to that node")</li>
</ol>

<p>Extracting skeletons from meshes (or other types of data such as voxels) is
non-trivial and there are a great many research papers exploring various
different approaches (see <a href="https://scholar.google.com/scholar
?hl=en&as_sdt=0%2C5&q=skeleton+extraction&btnG=">Google scholar</a>).</p>

<p><code><a href="">skeletor</a></code> implements some algorithms that I found useful in my work with
neurons. In my experience there is unfortuntely no magic bullet when it
comes to skeletonization and chances are you will have to fiddle around a bit
to get decent results.</p>

<h1 id="installation">Installation</h1>

<p>From PyPI:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code>pip3<span class="w"> </span>install<span class="w"> </span>skeletor
</code></pre>
</div>

<p>For the bleeding-edge version from Github:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code>pip3<span class="w"> </span>install<span class="w"> </span>git+https://github.com/navis-org/skeletor@master
</code></pre>
</div>

<h1 id="getting-started">Getting started</h1>

<p>A skeletonization pipeline typically consists of:</p>

<ol>
<li>Some pre-processing of the mesh (e.g. fixing some potential errors like
degenerate faces, unreferenced vertices, etc.)</li>
<li>The skeletonization itself</li>
<li>Some post-processing of the skeleton (e.g. adding radius information, smoothing, etc.)</li>
</ol>

<hr />

<p>Here is a complete list of available functions:</p>

<table>
<thead>
<tr>
  <th>function</th>
  <th>description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>example data</strong></td>
  <td></td>
</tr>
<tr>
  <td><code><a href="#example_mesh">skeletor.example_mesh()</a></code></td>
  <td>load an example mesh</td>
</tr>
<tr>
  <td><strong>pre-processing</strong></td>
  <td></td>
</tr>
<tr>
  <td><code><a href="skeletor/pre.html#fix_mesh">skeletor.pre.fix_mesh()</a></code></td>
  <td>fix some common errors found in meshes</td>
</tr>
<tr>
  <td><code><a href="skeletor/pre.html#remesh">skeletor.pre.remesh()</a></code></td>
  <td>re-generate mesh (uses Blender 3D)</td>
</tr>
<tr>
  <td><code><a href="skeletor/pre.html#simplify">skeletor.pre.simplify()</a></code></td>
  <td>reduce mesh complexity (uses Blender 3D)</td>
</tr>
<tr>
  <td><code><a href="skeletor/pre.html#contract">skeletor.pre.contract()</a></code></td>
  <td>contract mesh to facilitate skeletonization [1]</td>
</tr>
<tr>
  <td><strong>skeletonization</strong></td>
  <td></td>
</tr>
<tr>
  <td><code><a href="skeletor/skeletonize.html#by_wavefront">skeletor.skeletonize.by_wavefront()</a></code></td>
  <td>very fast, works well for tubular meshes (like neurons)</td>
</tr>
<tr>
  <td><code><a href="skeletor/skeletonize.html#by_vertex_clusters">skeletor.skeletonize.by_vertex_clusters()</a></code></td>
  <td>very fast but needs mesh to be contracted (see above)</td>
</tr>
<tr>
  <td><code><a href="skeletor/skeletonize.html#by_edge_collapse">skeletor.skeletonize.by_edge_collapse()</a></code></td>
  <td>presented in [1] but never got this to work well</td>
</tr>
<tr>
  <td><code><a href="skeletor/skeletonize.html#by_teasar">skeletor.skeletonize.by_teasar()</a></code></td>
  <td>very fast and robust, works on mesh surface</td>
</tr>
<tr>
  <td><code><a href="skeletor/skeletonize.html#by_tangent_ball">skeletor.skeletonize.by_tangent_ball()</a></code></td>
  <td>very fast, best on smooth meshes</td>
</tr>
<tr>
  <td><strong>postprocessing</strong></td>
  <td></td>
</tr>
<tr>
  <td><code><a href="skeletor/post.html#clean_up">skeletor.post.clean_up()</a></code></td>
  <td>fix some potential errors in the skeleton</td>
</tr>
<tr>
  <td><code><a href="skeletor/post.html#radii">skeletor.post.radii()</a></code></td>
  <td>add radius information using various method</td>
</tr>
<tr>
  <td><code><a href="skeletor/post.html#smooth">skeletor.post.smooth()</a></code></td>
  <td>smooth the skeleton</td>
</tr>
<tr>
  <td><code><a href="skeletor/post.html#remove_bristles">skeletor.post.remove_bristles()</a></code></td>
  <td>remove single-node bristles from the skeleton</td>
</tr>
<tr>
  <td><code><a href="skeletor/post.html#despike">skeletor.post.despike()</a></code></td>
  <td>smooth out jumps in the skeleton</td>
</tr>
</tbody>
</table>

<hr />

<p>See docstrings of the respective functions for details.</p>

<p>A pipeline might look like this:</p>

<ol>
<li><code><a href="skeletor/pre.html#fix_mesh">skeletor.pre.fix_mesh()</a></code> to fix the mesh</li>
<li><code><a href="skeletor/pre.html#simplify">skeletor.pre.simplify()</a></code> to simplify the mesh</li>
<li><code><a href="skeletor/pre.html#contract">skeletor.pre.contract()</a></code> to contract the mesh [1]</li>
<li><code><a href="skeletor/skeletonize.html#by_vertex_clusters">skeletor.skeletonize.by_vertex_clusters()</a></code> to generate a skeleton</li>
<li><code><a href="skeletor/post.html#clean_up">skeletor.post.clean_up()</a></code> to clean up some potential issues with the skeleton</li>
<li><code><a href="skeletor/post.html#smooth">skeletor.post.smooth()</a></code> to smooth the skeleton</li>
<li><code><a href="skeletor/post.html#radii">skeletor.post.radii()</a></code> to extract radii either by k-nearest neighbours or ray-casting</li>
</ol>

<p>In my experience there is no one-size-fits-all. You will have to play around to
find the right approach and parameters to get nice skeletons for your meshes.
If you need help just open an <a href="https://github.com/navis-org/skeletor/issues">issue</a>.</p>

<p>Also check out the Gotchas below!</p>

<h1 id="examples">Examples</h1>

<p>First load the example mesh (a fruit fly neuron):</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">skeletor</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sk</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mesh</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">example_mesh</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mesh</span>
<span class="o">&lt;</span><span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">(</span><span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">6582</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">faces</span><span class="o">.</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">13772</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">&gt;</span>
</code></pre>
</div>

<p>Next see if there is stuff to fix in the mesh (degenerate faces, duplicate
vertices, etc.):</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">fixed</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">fix_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">remove_disconnected</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fixed</span>
<span class="o">&lt;</span><span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">(</span><span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">6213</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">faces</span><span class="o">.</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">12805</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">&gt;</span>
</code></pre>
</div>

<p>Now for tubular meshes like this neuron, the "wave front" skeletonization method
performs really well: it works by casting waves across the mesh and collapsing
the resulting rings into a skeleton (kinda like when you throw a stone in a
pond and track the expanding ripples).</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">skel</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">skeletonize</span><span class="o">.</span><span class="n">by_wavefront</span><span class="p">(</span><span class="n">fixed</span><span class="p">,</span> <span class="n">waves</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">skel</span>
<span class="o">&lt;</span><span class="n">Skeleton</span><span class="p">(</span><span class="n">vertices</span><span class="o">=</span><span class="p">(</span><span class="mi">1258</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">edges</span><span class="o">=</span><span class="p">(</span><span class="mi">1194</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">wavefront</span><span class="p">)</span><span class="o">&gt;</span>
</code></pre>
</div>

<p>All skeletonization methods return a <code><a href="#Skeleton">Skeleton</a></code> object. These are just
convenient objects to bundle the various outputs of the skeletonization.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="c1"># x/y/z location of skeleton vertices (nodes)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">skel</span><span class="o">.</span><span class="n">vertices</span>
<span class="n">array</span><span class="p">([[</span><span class="mi">16744</span><span class="p">,</span> <span class="mi">36720</span><span class="p">,</span> <span class="mi">26407</span><span class="p">],</span>
       <span class="o">...</span><span class="p">,</span>
       <span class="p">[</span><span class="mi">22076</span><span class="p">,</span> <span class="mi">23217</span><span class="p">,</span> <span class="mi">24472</span><span class="p">]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># child -&gt; parent edges</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">skel</span><span class="o">.</span><span class="n">edges</span>
<span class="n">array</span><span class="p">([[</span>  <span class="mi">64</span><span class="p">,</span>   <span class="mi">31</span><span class="p">],</span>
       <span class="o">...</span><span class="p">,</span>
       <span class="p">[</span><span class="mi">1257</span><span class="p">,</span> <span class="mi">1252</span><span class="p">]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Mapping for mesh to skeleton vertex indices</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">skel</span><span class="o">.</span><span class="n">mesh_map</span>
<span class="n">array</span><span class="p">([</span> <span class="mi">157</span><span class="p">,</span>  <span class="mi">158</span><span class="p">,</span> <span class="mi">1062</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>  <span class="mi">525</span><span class="p">,</span>  <span class="mi">474</span><span class="p">,</span>  <span class="mi">547</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># SWC table</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">skel</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
   <span class="n">node_id</span>  <span class="n">parent_id</span>             <span class="n">x</span>             <span class="n">y</span>             <span class="n">z</span>    <span class="n">radius</span>
<span class="mi">0</span>        <span class="mi">0</span>         <span class="o">-</span><span class="mi">1</span>  <span class="mf">16744.005859</span>  <span class="mf">36720.058594</span>  <span class="mf">26407.902344</span>  <span class="mf">0.000000</span>
<span class="mi">1</span>        <span class="mi">1</span>         <span class="o">-</span><span class="mi">1</span>   <span class="mf">5602.751953</span>  <span class="mf">22266.756510</span>  <span class="mf">15799.991211</span>  <span class="mf">7.542587</span>
<span class="mi">2</span>        <span class="mi">2</span>         <span class="o">-</span><span class="mi">1</span>  <span class="mf">16442.666667</span>  <span class="mf">14999.978516</span>  <span class="mf">10887.916016</span>  <span class="mf">5.333333</span>
</code></pre>
</div>

<p>SWC is a commonly used format for saving skeletons. <code><a href="#Skeleton">Skeleton</a></code> objects
have a method for quickly saving a correctly formatted SWC file:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">skel</span><span class="o">.</span><span class="n">save_swc</span><span class="p">(</span><span class="s1">&#39;~/Documents/my_skeleton.swc&#39;</span><span class="p">)</span>
</code></pre>
</div>

<p>If you installed <code>pyglet</code> (see above) you can also use <code>trimesh</code>'s plotting
capabilities to inspect the results:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">skel</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="https://github.com/navis-org/skeletor/raw/master/_static/example1.png" alt="skeletor_example" width="100%"/></p>

<p>That looks pretty good already but let's run some pro-forma postprocessing.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">sk</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">clean_up</span><span class="p">(</span><span class="n">skel</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">Skeleton</span><span class="p">(</span><span class="n">vertices</span><span class="o">=</span><span class="p">(</span><span class="mi">1071</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">edges</span><span class="o">=</span><span class="p">(</span><span class="mi">1070</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">&gt;</span>
</code></pre>
</div>

<p>So that would be a full pipeline mesh to skeleton. Don't expect your own meshes
to produce such nice results off the bat though. Chances are you will need to
play around to find the right recipe. If you don't know where to start, I suggest
you try out mesh contraction + vertex clustering first:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">skeletor</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sk</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Load the example mesh that ships with skeletor</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mesh</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">example_mesh</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Alternatively use trimesh to load/construct your own mesh:</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># import trimesh as tm</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># mesh = tm.Trimesh(vertices, faces)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># mesh = tm.load_mesh(&#39;some/mesh.obj&#39;)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Run some general clean-up (see docstring for details)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fixed</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">fix_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">remove_disconnected</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Contract mesh to 10% (0.1) of original volume</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cont</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="n">fixed</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Skeletonize</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">skel</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">skeletonize</span><span class="o">.</span><span class="n">by_vertex_clusters</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="n">sampling_dist</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Replace contracted mesh with original for postprocessing and plotting</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">skel</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">fixed</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Add radii (vertex cluster method does not do that automatically)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sk</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">radii</span><span class="p">(</span><span class="n">skel</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;knn&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">skel</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre>
</div>

<h1 id="gotchas">Gotchas</h1>

<ul>
<li>while this is a general purpose library, my personal focus is on neurons and
this has certainly influenced things like default parameter values and certain
post-processing steps</li>
<li>meshes need to be triangular (we are using <code>trimesh</code>)</li>
<li>use <code>sk.pre.simplify</code> if your mesh is very complex (half a million vertices is
where things start getting sluggish)</li>
<li>a good mesh contraction is often half the battle but it can be tricky to get
to work</li>
<li>if the mesh consists of multiple disconnected pieces the skeleton will
likewise be fragmented (i.e. will have multiple roots)</li>
<li>it's often a good idea to fix issues with the skeleton in postprocessing rather
than trying to get the skeletonization to be perfect</li>
</ul>

<h1 id="benchmarks">Benchmarks</h1>

<p><img src="https://github.com/navis-org/skeletor/raw/master/benchmarks/benchmark_2.png" alt="skeletor_benchmark" width="100%"/></p>

<p><a href="https://github.com/navis-org/skeletor/blob/master/benchmarks/skeletor_benchmark.ipynb">Benchmarks</a>
were run on a 2018 MacBook Pro (2.2 GHz Core i7, 32Gb memory) with optional
<code>fastremap</code> dependency installed. Note some of these functions (e.g.
contraction and TEASAR/vertex cluster skeletonization) vary a lot in
speed based on parameterization.</p>

<h1 id="what-about-algorithm-x">What about algorithm <code>X</code>?</h1>

<p><code><a href="">skeletor</a></code> contains some algorithms that I found easy enough to implement
and useful for my work with neurons. If you have some interesting paper/approach
that could make a nice addition to <code><a href="">skeletor</a></code>, please get in touch on Github.
Pull requests are always welcome!</p>

<h1 id="references">References</h1>

<p><code>[1] Au OK, Tai CL, Chu HK, Cohen-Or D, Lee TY. Skeleton extraction by mesh contraction. ACM Transactions on Graphics (TOG). 2008 Aug 1;27(3):44.</code></p>

<p>The abstract and the paper can be found <a href="http://visgraph.cse.ust.hk/projects/skeleton/">here</a>.
Also see <a href="https://www.youtube.com/watch?v=-H7n59YQCRM&feature=youtu.be">this</a> YouTube video.</p>

<p>Some of the code in skeletor was modified from the
<a href="https://github.com/aalavandhaann/Py_BL_MeshSkeletonization">Py_BL_MeshSkeletonization</a>
addon created by #0K Srinivasan Ramachandran and published under GPL3.</p>

<h1 id="top-level-functions-and-classes">Top-level functions and classes</h1>

<p>At top-level we only expose <code><a href="#example_mesh">example_mesh()</a></code> and the <code><a href="#Skeleton">Skeleton</a></code> class (which
you probably won't ever need to touch manually). Everything else is neatly
tucked away into submodules (see side-bar or above table).</p>
</div>

                        <input id="mod-skeletor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-skeletor-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1">#    This script is part of skeletor (http://www.github.com/navis-org/skeletor).</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="c1">#    Copyright (C) 2018 Philipp Schlegel</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="c1">#</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="c1">#    This program is free software: you can redistribute it and/or modify</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="c1">#    it under the terms of the GNU General Public License as published by</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="c1">#    the Free Software Foundation, either version 3 of the License, or</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="c1">#    (at your option) any later version.</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="c1">#</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="c1">#    This program is distributed in the hope that it will be useful,</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="c1">#    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="c1">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="c1">#    GNU General Public License for more details.</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="c1">#</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="c1">#    You should have received a copy of the GNU General Public License</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="c1">#    along with this program.</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd"># What is skeletor?</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">Unlike its [namesake](https://en.wikipedia.org/wiki/Skeletor), this `skeletor`</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">does not (yet) seek to conquer Eternia but to turn meshes into skeletons.</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">Before we get started some terminology:</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">- a *mesh* is something that consists of *vertices* and *faces*</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">- a *skeleton* is a (hierarchical) tree-like structure consisting of *vertices*</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">  (also called *nodes*) and *edges* that connect them</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">Skeletons are useful for a range of reasons. For example:</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">1. Typically smaller (less vertices) than the mesh</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">2. Have an implicit sense of topology (e.g. &quot;this node is distal to that node&quot;)</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">Extracting skeletons from meshes (or other types of data such as voxels) is</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">non-trivial and there are a great many research papers exploring various</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">different approaches (see [Google scholar](https://scholar.google.com/scholar</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">?hl=en&amp;as_sdt=0%2C5&amp;q=skeleton+extraction&amp;btnG=)).</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">`skeletor` implements some algorithms that I found useful in my work with</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">neurons. In my experience there is unfortuntely no magic bullet when it</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">comes to skeletonization and chances are you will have to fiddle around a bit</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">to get decent results.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd"># Installation</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">From PyPI:</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">```bash</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">pip3 install skeletor</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">```</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">For the bleeding-edge version from Github:</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">```bash</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">pip3 install git+https://github.com/navis-org/skeletor@master</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">```</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd"># Getting started</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">A skeletonization pipeline typically consists of:</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">1. Some pre-processing of the mesh (e.g. fixing some potential errors like</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">   degenerate faces, unreferenced vertices, etc.)</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">2. The skeletonization itself</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">3. Some post-processing of the skeleton (e.g. adding radius information, smoothing, etc.)</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">------</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">Here is a complete list of available functions:</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">| function                                    | description                                                 |</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">| ------------------------------------------- | ----------------------------------------------------------- |</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">| **example data**                            |                                                             |</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">| `skeletor.example_mesh()`                   | load an example mesh                                        |</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">| **pre-processing**                          |                                                             |</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">| `skeletor.pre.fix_mesh()`                   | fix some common errors found in meshes                      |</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">| `skeletor.pre.remesh()`                     | re-generate mesh (uses Blender 3D)                          |</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">| `skeletor.pre.simplify()`                   | reduce mesh complexity (uses Blender 3D)                    |</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">| `skeletor.pre.contract()`                   | contract mesh to facilitate skeletonization [1]             |</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">| **skeletonization**                         |                                                             |</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">| `skeletor.skeletonize.by_wavefront()`       | very fast, works well for tubular meshes (like neurons)     |</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">| `skeletor.skeletonize.by_vertex_clusters()` | very fast but needs mesh to be contracted (see above)       |</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">| `skeletor.skeletonize.by_edge_collapse()`   | presented in [1] but never got this to work well            |</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">| `skeletor.skeletonize.by_teasar()`          | very fast and robust, works on mesh surface                 |</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">| `skeletor.skeletonize.by_tangent_ball()`    | very fast, best on smooth meshes                            |</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">| **postprocessing**                          |                                                             |</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">| `skeletor.post.clean_up()`                  | fix some potential errors in the skeleton                   |</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">| `skeletor.post.radii()`                     | add radius information using various method                 |</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">| `skeletor.post.smooth()`                    | smooth the skeleton                                         |</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">| `skeletor.post.remove_bristles()`           | remove single-node bristles from the skeleton               |</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">| `skeletor.post.despike()`                   | smooth out jumps in the skeleton                            |</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">------</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">See docstrings of the respective functions for details.</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">A pipeline might look like this:</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd"> 1. `skeletor.pre.fix_mesh()` to fix the mesh</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd"> 2. `skeletor.pre.simplify()` to simplify the mesh</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd"> 3. `skeletor.pre.contract()` to contract the mesh [1]</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd"> 4. `skeletor.skeletonize.by_vertex_clusters()` to generate a skeleton</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd"> 5. `skeletor.post.clean_up()` to clean up some potential issues with the skeleton</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd"> 6. `skeletor.post.smooth()` to smooth the skeleton</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd"> 7. `skeletor.post.radii()` to extract radii either by k-nearest neighbours or ray-casting</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">In my experience there is no one-size-fits-all. You will have to play around to</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">find the right approach and parameters to get nice skeletons for your meshes.</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">If you need help just open an [issue](https://github.com/navis-org/skeletor/issues).</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">Also check out the Gotchas below!</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd"># Examples</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">First load the example mesh (a fruit fly neuron):</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">```Python</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">&gt;&gt;&gt; import skeletor as sk</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">&gt;&gt;&gt; mesh = sk.example_mesh()</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">&gt;&gt;&gt; mesh</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">&lt;trimesh.Trimesh(vertices.shape=(6582, 3), faces.shape=(13772, 3))&gt;</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">```</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">Next see if there is stuff to fix in the mesh (degenerate faces, duplicate</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">vertices, etc.):</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">```Python</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">&gt;&gt;&gt; fixed = sk.pre.fix_mesh(mesh, remove_disconnected=5, inplace=False)</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">&gt;&gt;&gt; fixed</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">&lt;trimesh.Trimesh(vertices.shape=(6213, 3), faces.shape=(12805, 3))&gt;</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">```</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">Now for tubular meshes like this neuron, the &quot;wave front&quot; skeletonization method</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">performs really well: it works by casting waves across the mesh and collapsing</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">the resulting rings into a skeleton (kinda like when you throw a stone in a</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">pond and track the expanding ripples).</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">```Python</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">&gt;&gt;&gt; skel = sk.skeletonize.by_wavefront(fixed, waves=1, step_size=1)</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">&gt;&gt;&gt; skel</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">&lt;Skeleton(vertices=(1258, 3), edges=(1194, 2), method=wavefront)&gt;</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">```</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">All skeletonization methods return a `Skeleton` object. These are just</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">convenient objects to bundle the various outputs of the skeletonization.</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">```Python</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">&gt;&gt;&gt; # x/y/z location of skeleton vertices (nodes)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">&gt;&gt;&gt; skel.vertices</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">array([[16744, 36720, 26407],</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">       ...,</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">       [22076, 23217, 24472]])</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">&gt;&gt;&gt; # child -&gt; parent edges</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">&gt;&gt;&gt; skel.edges</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">array([[  64,   31],</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">       ...,</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">       [1257, 1252]])</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">&gt;&gt;&gt; # Mapping for mesh to skeleton vertex indices</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">&gt;&gt;&gt; skel.mesh_map</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">array([ 157,  158, 1062, ...,  525,  474,  547])</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">&gt;&gt;&gt; # SWC table</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">&gt;&gt;&gt; skel.swc.head()</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">   node_id  parent_id             x             y             z    radius</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">0        0         -1  16744.005859  36720.058594  26407.902344  0.000000</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">1        1         -1   5602.751953  22266.756510  15799.991211  7.542587</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">2        2         -1  16442.666667  14999.978516  10887.916016  5.333333</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">```</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">SWC is a commonly used format for saving skeletons. `Skeleton` objects</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">have a method for quickly saving a correctly formatted SWC file:</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">```Python</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">&gt;&gt;&gt; skel.save_swc(&#39;~/Documents/my_skeleton.swc&#39;)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">```</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">If you installed `pyglet` (see above) you can also use `trimesh`&#39;s plotting</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">capabilities to inspect the results:</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">```Python</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">&gt;&gt;&gt; skel.show(mesh=True)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">```</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">&lt;img src=&quot;https://github.com/navis-org/skeletor/raw/master/_static/example1.png&quot; alt=&quot;skeletor_example&quot; width=&quot;100%&quot;/&gt;</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">That looks pretty good already but let&#39;s run some pro-forma postprocessing.</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">```Python</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">&gt;&gt;&gt; sk.post.clean_up(skel, inplace=True)</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="sd">&lt;Skeleton(vertices=(1071, 3), edges=(1070, 2))&gt;</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="sd">```</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="sd">So that would be a full pipeline mesh to skeleton. Don&#39;t expect your own meshes</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">to produce such nice results off the bat though. Chances are you will need to</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">play around to find the right recipe. If you don&#39;t know where to start, I suggest</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">you try out mesh contraction + vertex clustering first:</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">```Python</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="sd">&gt;&gt;&gt; import skeletor as sk</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">&gt;&gt;&gt; # Load the example mesh that ships with skeletor</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">&gt;&gt;&gt; mesh = sk.example_mesh()</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">&gt;&gt;&gt; # Alternatively use trimesh to load/construct your own mesh:</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">&gt;&gt;&gt; # import trimesh as tm</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">&gt;&gt;&gt; # mesh = tm.Trimesh(vertices, faces)</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">&gt;&gt;&gt; # mesh = tm.load_mesh(&#39;some/mesh.obj&#39;)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">&gt;&gt;&gt; # Run some general clean-up (see docstring for details)</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">&gt;&gt;&gt; fixed = sk.pre.fix_mesh(mesh, remove_disconnected=5, inplace=False)</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">&gt;&gt;&gt; # Contract mesh to 10% (0.1) of original volume</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="sd">&gt;&gt;&gt; cont = sk.pre.contract(fixed, epsilon=0.1)</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">&gt;&gt;&gt; # Skeletonize</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">&gt;&gt;&gt; skel = sk.skeletonize.by_vertex_clusters(cont, sampling_dist=100)</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">&gt;&gt;&gt; # Replace contracted mesh with original for postprocessing and plotting</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">&gt;&gt;&gt; skel.mesh = fixed</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">&gt;&gt;&gt; # Add radii (vertex cluster method does not do that automatically)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">&gt;&gt;&gt; sk.post.radii(skel, method=&#39;knn&#39;)</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">&gt;&gt;&gt; skel.show(mesh=True)</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">```</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd"># Gotchas</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">- while this is a general purpose library, my personal focus is on neurons and</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">  this has certainly influenced things like default parameter values and certain</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">  post-processing steps</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">- meshes need to be triangular (we are using `trimesh`)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">- use `sk.pre.simplify` if your mesh is very complex (half a million vertices is</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">  where things start getting sluggish)</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">- a good mesh contraction is often half the battle but it can be tricky to get</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">  to work</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">- if the mesh consists of multiple disconnected pieces the skeleton will</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">  likewise be fragmented (i.e. will have multiple roots)</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">- it&#39;s often a good idea to fix issues with the skeleton in postprocessing rather</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">  than trying to get the skeletonization to be perfect</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd"># Benchmarks</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">&lt;img src=&quot;https://github.com/navis-org/skeletor/raw/master/benchmarks/benchmark_2.png&quot; alt=&quot;skeletor_benchmark&quot; width=&quot;100%&quot;/&gt;</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">[Benchmarks](https://github.com/navis-org/skeletor/blob/master/benchmarks/skeletor_benchmark.ipynb)</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">were run on a 2018 MacBook Pro (2.2 GHz Core i7, 32Gb memory) with optional</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">`fastremap` dependency installed. Note some of these functions (e.g.</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">contraction and TEASAR/vertex cluster skeletonization) vary a lot in</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">speed based on parameterization.</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd"># What about algorithm `X`?</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">`skeletor` contains some algorithms that I found easy enough to implement</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">and useful for my work with neurons. If you have some interesting paper/approach</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">that could make a nice addition to `skeletor`, please get in touch on Github.</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">Pull requests are always welcome!</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd"># References</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">`[1] Au OK, Tai CL, Chu HK, Cohen-Or D, Lee TY. Skeleton extraction by mesh contraction. ACM Transactions on Graphics (TOG). 2008 Aug 1;27(3):44.`</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">The abstract and the paper can be found [here](http://visgraph.cse.ust.hk/projects/skeleton/).</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">Also see [this](https://www.youtube.com/watch?v=-H7n59YQCRM&amp;feature=youtu.be) YouTube video.</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">Some of the code in skeletor was modified from the</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="sd">[Py_BL_MeshSkeletonization](https://github.com/aalavandhaann/Py_BL_MeshSkeletonization)</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">addon created by #0K Srinivasan Ramachandran and published under GPL3.</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a><span class="sd"># Top-level functions and classes</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="sd">At top-level we only expose `example_mesh()` and the `Skeleton` class (which</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a><span class="sd">you probably won&#39;t ever need to touch manually). Everything else is neatly</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">tucked away into submodules (see side-bar or above table).</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;1.3.0&quot;</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="n">__version_vector__</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">skeletonize</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">pre</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">post</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.skeletonize.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">Skeleton</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">example_mesh</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="n">__docformat__</span> <span class="o">=</span> <span class="s2">&quot;numpy&quot;</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Skeleton&#39;</span><span class="p">,</span> <span class="s1">&#39;example_mesh&#39;</span><span class="p">,</span> <span class="s1">&#39;pre&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="s1">&#39;skeletonize&#39;</span><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="Skeleton">
                            <input id="Skeleton-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Skeleton</span>:

                <label class="view-source-button" for="Skeleton-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Skeleton"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Skeleton-33"><a href="#Skeleton-33"><span class="linenos"> 33</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Skeleton</span><span class="p">:</span>
</span><span id="Skeleton-34"><a href="#Skeleton-34"><span class="linenos"> 34</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Class representing a skeleton.</span>
</span><span id="Skeleton-35"><a href="#Skeleton-35"><span class="linenos"> 35</span></a>
</span><span id="Skeleton-36"><a href="#Skeleton-36"><span class="linenos"> 36</span></a><span class="sd">    Typically returned as results from a skeletonization.</span>
</span><span id="Skeleton-37"><a href="#Skeleton-37"><span class="linenos"> 37</span></a>
</span><span id="Skeleton-38"><a href="#Skeleton-38"><span class="linenos"> 38</span></a><span class="sd">    Attributes</span>
</span><span id="Skeleton-39"><a href="#Skeleton-39"><span class="linenos"> 39</span></a><span class="sd">    ----------</span>
</span><span id="Skeleton-40"><a href="#Skeleton-40"><span class="linenos"> 40</span></a><span class="sd">    swc :       pd.DataFrame, optional</span>
</span><span id="Skeleton-41"><a href="#Skeleton-41"><span class="linenos"> 41</span></a><span class="sd">                SWC table.</span>
</span><span id="Skeleton-42"><a href="#Skeleton-42"><span class="linenos"> 42</span></a><span class="sd">    vertices :  (N, 3) array</span>
</span><span id="Skeleton-43"><a href="#Skeleton-43"><span class="linenos"> 43</span></a><span class="sd">                Vertex (node) positions.</span>
</span><span id="Skeleton-44"><a href="#Skeleton-44"><span class="linenos"> 44</span></a><span class="sd">    edges :     (M, 2) array</span>
</span><span id="Skeleton-45"><a href="#Skeleton-45"><span class="linenos"> 45</span></a><span class="sd">                Indices of connected vertex pairs.</span>
</span><span id="Skeleton-46"><a href="#Skeleton-46"><span class="linenos"> 46</span></a><span class="sd">    radii :     (N, ) array, optional</span>
</span><span id="Skeleton-47"><a href="#Skeleton-47"><span class="linenos"> 47</span></a><span class="sd">                Radii for each vertex (node) in the skeleton.</span>
</span><span id="Skeleton-48"><a href="#Skeleton-48"><span class="linenos"> 48</span></a><span class="sd">    mesh :      trimesh, optional</span>
</span><span id="Skeleton-49"><a href="#Skeleton-49"><span class="linenos"> 49</span></a><span class="sd">                The original mesh.</span>
</span><span id="Skeleton-50"><a href="#Skeleton-50"><span class="linenos"> 50</span></a><span class="sd">    mesh_map :  array, optional</span>
</span><span id="Skeleton-51"><a href="#Skeleton-51"><span class="linenos"> 51</span></a><span class="sd">                Same length as ``mesh``. Maps mesh vertices to vertices (nodes)</span>
</span><span id="Skeleton-52"><a href="#Skeleton-52"><span class="linenos"> 52</span></a><span class="sd">                in the skeleton.</span>
</span><span id="Skeleton-53"><a href="#Skeleton-53"><span class="linenos"> 53</span></a><span class="sd">    skel_map :  array of arrays, optional</span>
</span><span id="Skeleton-54"><a href="#Skeleton-54"><span class="linenos"> 54</span></a><span class="sd">                Inverse of `mesh_map`: maps skeleton vertices (nodes) to mesh</span>
</span><span id="Skeleton-55"><a href="#Skeleton-55"><span class="linenos"> 55</span></a><span class="sd">                vertices.</span>
</span><span id="Skeleton-56"><a href="#Skeleton-56"><span class="linenos"> 56</span></a><span class="sd">    method :    str, optional</span>
</span><span id="Skeleton-57"><a href="#Skeleton-57"><span class="linenos"> 57</span></a><span class="sd">                Which method was used to generate the skeleton.</span>
</span><span id="Skeleton-58"><a href="#Skeleton-58"><span class="linenos"> 58</span></a>
</span><span id="Skeleton-59"><a href="#Skeleton-59"><span class="linenos"> 59</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Skeleton-60"><a href="#Skeleton-60"><span class="linenos"> 60</span></a>
</span><span id="Skeleton-61"><a href="#Skeleton-61"><span class="linenos"> 61</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">swc</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mesh_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Skeleton-62"><a href="#Skeleton-62"><span class="linenos"> 62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">swc</span> <span class="o">=</span> <span class="n">swc</span>
</span><span id="Skeleton-63"><a href="#Skeleton-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span>
</span><span id="Skeleton-64"><a href="#Skeleton-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_map</span> <span class="o">=</span> <span class="n">mesh_map</span>
</span><span id="Skeleton-65"><a href="#Skeleton-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
</span><span id="Skeleton-66"><a href="#Skeleton-66"><span class="linenos"> 66</span></a>
</span><span id="Skeleton-67"><a href="#Skeleton-67"><span class="linenos"> 67</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton-68"><a href="#Skeleton-68"><span class="linenos"> 68</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Summary.&quot;&quot;&quot;</span>
</span><span id="Skeleton-69"><a href="#Skeleton-69"><span class="linenos"> 69</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
</span><span id="Skeleton-70"><a href="#Skeleton-70"><span class="linenos"> 70</span></a>
</span><span id="Skeleton-71"><a href="#Skeleton-71"><span class="linenos"> 71</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton-72"><a href="#Skeleton-72"><span class="linenos"> 72</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return quick summary of the skeleton&#39;s geometry.&quot;&quot;&quot;</span>
</span><span id="Skeleton-73"><a href="#Skeleton-73"><span class="linenos"> 73</span></a>        <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Skeleton-74"><a href="#Skeleton-74"><span class="linenos"> 74</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;vertices&quot;</span><span class="p">):</span>
</span><span id="Skeleton-75"><a href="#Skeleton-75"><span class="linenos"> 75</span></a>            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;vertices=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Skeleton-76"><a href="#Skeleton-76"><span class="linenos"> 76</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;edges&quot;</span><span class="p">):</span>
</span><span id="Skeleton-77"><a href="#Skeleton-77"><span class="linenos"> 77</span></a>            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;edges=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Skeleton-78"><a href="#Skeleton-78"><span class="linenos"> 78</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">):</span>
</span><span id="Skeleton-79"><a href="#Skeleton-79"><span class="linenos"> 79</span></a>            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;method=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Skeleton-80"><a href="#Skeleton-80"><span class="linenos"> 80</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&lt;Skeleton(</span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span><span class="si">}</span><span class="s1">)&gt;&#39;</span>
</span><span id="Skeleton-81"><a href="#Skeleton-81"><span class="linenos"> 81</span></a>
</span><span id="Skeleton-82"><a href="#Skeleton-82"><span class="linenos"> 82</span></a>    <span class="nd">@property</span>
</span><span id="Skeleton-83"><a href="#Skeleton-83"><span class="linenos"> 83</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton-84"><a href="#Skeleton-84"><span class="linenos"> 84</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return skeleton edges.&quot;&quot;&quot;</span>
</span><span id="Skeleton-85"><a href="#Skeleton-85"><span class="linenos"> 85</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;node_id&quot;</span><span class="p">,</span> <span class="s2">&quot;parent_id&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Skeleton-86"><a href="#Skeleton-86"><span class="linenos"> 86</span></a>
</span><span id="Skeleton-87"><a href="#Skeleton-87"><span class="linenos"> 87</span></a>    <span class="nd">@property</span>
</span><span id="Skeleton-88"><a href="#Skeleton-88"><span class="linenos"> 88</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton-89"><a href="#Skeleton-89"><span class="linenos"> 89</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return skeleton vertices (nodes).&quot;&quot;&quot;</span>
</span><span id="Skeleton-90"><a href="#Skeleton-90"><span class="linenos"> 90</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Skeleton-91"><a href="#Skeleton-91"><span class="linenos"> 91</span></a>
</span><span id="Skeleton-92"><a href="#Skeleton-92"><span class="linenos"> 92</span></a>    <span class="nd">@property</span>
</span><span id="Skeleton-93"><a href="#Skeleton-93"><span class="linenos"> 93</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton-94"><a href="#Skeleton-94"><span class="linenos"> 94</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return radii.&quot;&quot;&quot;</span>
</span><span id="Skeleton-95"><a href="#Skeleton-95"><span class="linenos"> 95</span></a>        <span class="k">if</span> <span class="s2">&quot;radius&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="Skeleton-96"><a href="#Skeleton-96"><span class="linenos"> 96</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Skeleton-97"><a href="#Skeleton-97"><span class="linenos"> 97</span></a>                <span class="s2">&quot;No radius info found. Run `skeletor.post.radii()`&quot;</span> <span class="s2">&quot; to get them.&quot;</span>
</span><span id="Skeleton-98"><a href="#Skeleton-98"><span class="linenos"> 98</span></a>            <span class="p">)</span>
</span><span id="Skeleton-99"><a href="#Skeleton-99"><span class="linenos"> 99</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Skeleton-100"><a href="#Skeleton-100"><span class="linenos">100</span></a>
</span><span id="Skeleton-101"><a href="#Skeleton-101"><span class="linenos">101</span></a>    <span class="nd">@property</span>
</span><span id="Skeleton-102"><a href="#Skeleton-102"><span class="linenos">102</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">skeleton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton-103"><a href="#Skeleton-103"><span class="linenos">103</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Skeleton as trimesh Path3D.&quot;&quot;&quot;</span>
</span><span id="Skeleton-104"><a href="#Skeleton-104"><span class="linenos">104</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_skeleton&quot;</span><span class="p">):</span>
</span><span id="Skeleton-105"><a href="#Skeleton-105"><span class="linenos">105</span></a>            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">tm</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">]</span>
</span><span id="Skeleton-106"><a href="#Skeleton-106"><span class="linenos">106</span></a>
</span><span id="Skeleton-107"><a href="#Skeleton-107"><span class="linenos">107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_skeleton</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">Path3D</span><span class="p">(</span>
</span><span id="Skeleton-108"><a href="#Skeleton-108"><span class="linenos">108</span></a>                <span class="n">entities</span><span class="o">=</span><span class="n">lines</span><span class="p">,</span> <span class="n">vertices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">process</span><span class="o">=</span><span class="kc">False</span>
</span><span id="Skeleton-109"><a href="#Skeleton-109"><span class="linenos">109</span></a>            <span class="p">)</span>
</span><span id="Skeleton-110"><a href="#Skeleton-110"><span class="linenos">110</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skeleton</span>
</span><span id="Skeleton-111"><a href="#Skeleton-111"><span class="linenos">111</span></a>
</span><span id="Skeleton-112"><a href="#Skeleton-112"><span class="linenos">112</span></a>    <span class="nd">@property</span>
</span><span id="Skeleton-113"><a href="#Skeleton-113"><span class="linenos">113</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">skel_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton-114"><a href="#Skeleton-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Skeleton vertex (nodes) to mesh vertices. Based on `mesh_map`.&quot;&quot;&quot;</span>
</span><span id="Skeleton-115"><a href="#Skeleton-115"><span class="linenos">115</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_map</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
</span><span id="Skeleton-116"><a href="#Skeleton-116"><span class="linenos">116</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Skeleton-117"><a href="#Skeleton-117"><span class="linenos">117</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="Skeleton-118"><a href="#Skeleton-118"><span class="linenos">118</span></a>            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_map</span><span class="p">)</span>
</span><span id="Skeleton-119"><a href="#Skeleton-119"><span class="linenos">119</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Skeleton-120"><a href="#Skeleton-120"><span class="linenos">120</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span>
</span><span id="Skeleton-121"><a href="#Skeleton-121"><span class="linenos">121</span></a>            <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
</span><span id="Skeleton-122"><a href="#Skeleton-122"><span class="linenos">122</span></a>            <span class="o">.</span><span class="n">values</span>
</span><span id="Skeleton-123"><a href="#Skeleton-123"><span class="linenos">123</span></a>        <span class="p">)</span>
</span><span id="Skeleton-124"><a href="#Skeleton-124"><span class="linenos">124</span></a>
</span><span id="Skeleton-125"><a href="#Skeleton-125"><span class="linenos">125</span></a>    <span class="nd">@property</span>
</span><span id="Skeleton-126"><a href="#Skeleton-126"><span class="linenos">126</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">roots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton-127"><a href="#Skeleton-127"><span class="linenos">127</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Root node(s).&quot;&quot;&quot;</span>
</span><span id="Skeleton-128"><a href="#Skeleton-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
</span><span id="Skeleton-129"><a href="#Skeleton-129"><span class="linenos">129</span></a>
</span><span id="Skeleton-130"><a href="#Skeleton-130"><span class="linenos">130</span></a>    <span class="nd">@property</span>
</span><span id="Skeleton-131"><a href="#Skeleton-131"><span class="linenos">131</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">leafs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton-132"><a href="#Skeleton-132"><span class="linenos">132</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Leaf nodes (includes root).&quot;&quot;&quot;</span>
</span><span id="Skeleton-133"><a href="#Skeleton-133"><span class="linenos">133</span></a>        <span class="n">swc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span>
</span><span id="Skeleton-134"><a href="#Skeleton-134"><span class="linenos">134</span></a>        <span class="n">leafs</span> <span class="o">=</span> <span class="n">swc</span><span class="p">[</span><span class="o">~</span><span class="n">swc</span><span class="o">.</span><span class="n">node_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">swc</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">swc</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)]</span>
</span><span id="Skeleton-135"><a href="#Skeleton-135"><span class="linenos">135</span></a>        <span class="k">return</span> <span class="n">leafs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Skeleton-136"><a href="#Skeleton-136"><span class="linenos">136</span></a>
</span><span id="Skeleton-137"><a href="#Skeleton-137"><span class="linenos">137</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reindex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Skeleton-138"><a href="#Skeleton-138"><span class="linenos">138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up skeleton.&quot;&quot;&quot;</span>
</span><span id="Skeleton-139"><a href="#Skeleton-139"><span class="linenos">139</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="Skeleton-140"><a href="#Skeleton-140"><span class="linenos">140</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
</span><span id="Skeleton-141"><a href="#Skeleton-141"><span class="linenos">141</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Skeleton-142"><a href="#Skeleton-142"><span class="linenos">142</span></a>
</span><span id="Skeleton-143"><a href="#Skeleton-143"><span class="linenos">143</span></a>        <span class="c1"># Re-index to make node IDs continous again</span>
</span><span id="Skeleton-144"><a href="#Skeleton-144"><span class="linenos">144</span></a>        <span class="n">x</span><span class="o">.</span><span class="n">swc</span><span class="p">,</span> <span class="n">new_ids</span> <span class="o">=</span> <span class="n">reindex_swc</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">swc</span><span class="p">)</span>
</span><span id="Skeleton-145"><a href="#Skeleton-145"><span class="linenos">145</span></a>
</span><span id="Skeleton-146"><a href="#Skeleton-146"><span class="linenos">146</span></a>        <span class="c1"># Update mesh map</span>
</span><span id="Skeleton-147"><a href="#Skeleton-147"><span class="linenos">147</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mesh_map</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
</span><span id="Skeleton-148"><a href="#Skeleton-148"><span class="linenos">148</span></a>            <span class="n">x</span><span class="o">.</span><span class="n">mesh_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">new_ids</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">mesh_map</span><span class="p">])</span>
</span><span id="Skeleton-149"><a href="#Skeleton-149"><span class="linenos">149</span></a>
</span><span id="Skeleton-150"><a href="#Skeleton-150"><span class="linenos">150</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
</span><span id="Skeleton-151"><a href="#Skeleton-151"><span class="linenos">151</span></a>            <span class="k">return</span> <span class="n">x</span>
</span><span id="Skeleton-152"><a href="#Skeleton-152"><span class="linenos">152</span></a>
</span><span id="Skeleton-153"><a href="#Skeleton-153"><span class="linenos">153</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reroot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_root</span><span class="p">):</span>
</span><span id="Skeleton-154"><a href="#Skeleton-154"><span class="linenos">154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reroot the skeleton.</span>
</span><span id="Skeleton-155"><a href="#Skeleton-155"><span class="linenos">155</span></a>
</span><span id="Skeleton-156"><a href="#Skeleton-156"><span class="linenos">156</span></a><span class="sd">        Parameters</span>
</span><span id="Skeleton-157"><a href="#Skeleton-157"><span class="linenos">157</span></a><span class="sd">        ----------</span>
</span><span id="Skeleton-158"><a href="#Skeleton-158"><span class="linenos">158</span></a><span class="sd">        new_root :  int</span>
</span><span id="Skeleton-159"><a href="#Skeleton-159"><span class="linenos">159</span></a><span class="sd">                    Index of node to use as new root. If the skeleton</span>
</span><span id="Skeleton-160"><a href="#Skeleton-160"><span class="linenos">160</span></a><span class="sd">                    consists of multiple trees, only the tree containing the</span>
</span><span id="Skeleton-161"><a href="#Skeleton-161"><span class="linenos">161</span></a><span class="sd">                    new root will be updated.</span>
</span><span id="Skeleton-162"><a href="#Skeleton-162"><span class="linenos">162</span></a>
</span><span id="Skeleton-163"><a href="#Skeleton-163"><span class="linenos">163</span></a><span class="sd">        Returns</span>
</span><span id="Skeleton-164"><a href="#Skeleton-164"><span class="linenos">164</span></a><span class="sd">        -------</span>
</span><span id="Skeleton-165"><a href="#Skeleton-165"><span class="linenos">165</span></a><span class="sd">        Skeleton</span>
</span><span id="Skeleton-166"><a href="#Skeleton-166"><span class="linenos">166</span></a><span class="sd">                    Skeleton with new root.</span>
</span><span id="Skeleton-167"><a href="#Skeleton-167"><span class="linenos">167</span></a>
</span><span id="Skeleton-168"><a href="#Skeleton-168"><span class="linenos">168</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Skeleton-169"><a href="#Skeleton-169"><span class="linenos">169</span></a>        <span class="k">assert</span> <span class="n">new_root</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Node index </span><span class="si">{</span><span class="n">new_root</span><span class="si">}</span><span class="s2"> not in skeleton.&quot;</span>
</span><span id="Skeleton-170"><a href="#Skeleton-170"><span class="linenos">170</span></a>
</span><span id="Skeleton-171"><a href="#Skeleton-171"><span class="linenos">171</span></a>        <span class="c1"># Make copy of self</span>
</span><span id="Skeleton-172"><a href="#Skeleton-172"><span class="linenos">172</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Skeleton-173"><a href="#Skeleton-173"><span class="linenos">173</span></a>
</span><span id="Skeleton-174"><a href="#Skeleton-174"><span class="linenos">174</span></a>        <span class="c1"># Check if the new root is already a root</span>
</span><span id="Skeleton-175"><a href="#Skeleton-175"><span class="linenos">175</span></a>        <span class="k">if</span> <span class="n">new_root</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">roots</span><span class="p">:</span>
</span><span id="Skeleton-176"><a href="#Skeleton-176"><span class="linenos">176</span></a>            <span class="k">return</span> <span class="n">x</span>
</span><span id="Skeleton-177"><a href="#Skeleton-177"><span class="linenos">177</span></a>
</span><span id="Skeleton-178"><a href="#Skeleton-178"><span class="linenos">178</span></a>        <span class="c1"># Get graph representation</span>
</span><span id="Skeleton-179"><a href="#Skeleton-179"><span class="linenos">179</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span>
</span><span id="Skeleton-180"><a href="#Skeleton-180"><span class="linenos">180</span></a>
</span><span id="Skeleton-181"><a href="#Skeleton-181"><span class="linenos">181</span></a>        <span class="c1"># Get the path from the new root to the current root (of the same tree)</span>
</span><span id="Skeleton-182"><a href="#Skeleton-182"><span class="linenos">182</span></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">roots</span><span class="p">:</span>
</span><span id="Skeleton-183"><a href="#Skeleton-183"><span class="linenos">183</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Skeleton-184"><a href="#Skeleton-184"><span class="linenos">184</span></a>                <span class="n">path</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">new_root</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>
</span><span id="Skeleton-185"><a href="#Skeleton-185"><span class="linenos">185</span></a>                <span class="k">break</span>
</span><span id="Skeleton-186"><a href="#Skeleton-186"><span class="linenos">186</span></a>            <span class="k">except</span> <span class="n">nx</span><span class="o">.</span><span class="n">NetworkXNoPath</span><span class="p">:</span>
</span><span id="Skeleton-187"><a href="#Skeleton-187"><span class="linenos">187</span></a>                <span class="k">continue</span>
</span><span id="Skeleton-188"><a href="#Skeleton-188"><span class="linenos">188</span></a>
</span><span id="Skeleton-189"><a href="#Skeleton-189"><span class="linenos">189</span></a>        <span class="c1"># Now we need to invert the path from the old root to the new root</span>
</span><span id="Skeleton-190"><a href="#Skeleton-190"><span class="linenos">190</span></a>        <span class="n">new_parents</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;node_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="Skeleton-191"><a href="#Skeleton-191"><span class="linenos">191</span></a>        <span class="n">new_parents</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">c</span><span class="p">:</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:])})</span>
</span><span id="Skeleton-192"><a href="#Skeleton-192"><span class="linenos">192</span></a>        <span class="n">new_parents</span><span class="p">[</span><span class="n">new_root</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Skeleton-193"><a href="#Skeleton-193"><span class="linenos">193</span></a>
</span><span id="Skeleton-194"><a href="#Skeleton-194"><span class="linenos">194</span></a>        <span class="c1"># Update the SWC table</span>
</span><span id="Skeleton-195"><a href="#Skeleton-195"><span class="linenos">195</span></a>        <span class="n">x</span><span class="o">.</span><span class="n">swc</span><span class="p">[</span><span class="s2">&quot;parent_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">node_id</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">new_parents</span><span class="p">)</span>
</span><span id="Skeleton-196"><a href="#Skeleton-196"><span class="linenos">196</span></a>
</span><span id="Skeleton-197"><a href="#Skeleton-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="n">x</span>
</span><span id="Skeleton-198"><a href="#Skeleton-198"><span class="linenos">198</span></a>
</span><span id="Skeleton-199"><a href="#Skeleton-199"><span class="linenos">199</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton-200"><a href="#Skeleton-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return copy of the skeleton.&quot;&quot;&quot;</span>
</span><span id="Skeleton-201"><a href="#Skeleton-201"><span class="linenos">201</span></a>        <span class="k">return</span> <span class="n">Skeleton</span><span class="p">(</span>
</span><span id="Skeleton-202"><a href="#Skeleton-202"><span class="linenos">202</span></a>            <span class="n">swc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Skeleton-203"><a href="#Skeleton-203"><span class="linenos">203</span></a>            <span class="n">mesh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Skeleton-204"><a href="#Skeleton-204"><span class="linenos">204</span></a>            <span class="n">mesh_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_map</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Skeleton-205"><a href="#Skeleton-205"><span class="linenos">205</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_map</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
</span><span id="Skeleton-206"><a href="#Skeleton-206"><span class="linenos">206</span></a>            <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Skeleton-207"><a href="#Skeleton-207"><span class="linenos">207</span></a>            <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="Skeleton-208"><a href="#Skeleton-208"><span class="linenos">208</span></a>        <span class="p">)</span>
</span><span id="Skeleton-209"><a href="#Skeleton-209"><span class="linenos">209</span></a>
</span><span id="Skeleton-210"><a href="#Skeleton-210"><span class="linenos">210</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton-211"><a href="#Skeleton-211"><span class="linenos">211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate networkX representation of the skeletons.</span>
</span><span id="Skeleton-212"><a href="#Skeleton-212"><span class="linenos">212</span></a>
</span><span id="Skeleton-213"><a href="#Skeleton-213"><span class="linenos">213</span></a><span class="sd">        Distance between nodes will be used as edge weights.</span>
</span><span id="Skeleton-214"><a href="#Skeleton-214"><span class="linenos">214</span></a>
</span><span id="Skeleton-215"><a href="#Skeleton-215"><span class="linenos">215</span></a><span class="sd">        Returns</span>
</span><span id="Skeleton-216"><a href="#Skeleton-216"><span class="linenos">216</span></a><span class="sd">        -------</span>
</span><span id="Skeleton-217"><a href="#Skeleton-217"><span class="linenos">217</span></a><span class="sd">        networkx.DiGraph</span>
</span><span id="Skeleton-218"><a href="#Skeleton-218"><span class="linenos">218</span></a>
</span><span id="Skeleton-219"><a href="#Skeleton-219"><span class="linenos">219</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Skeleton-220"><a href="#Skeleton-220"><span class="linenos">220</span></a>        <span class="n">not_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">&gt;=</span> <span class="mi">0</span>
</span><span id="Skeleton-221"><a href="#Skeleton-221"><span class="linenos">221</span></a>        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_root</span><span class="p">]</span>
</span><span id="Skeleton-222"><a href="#Skeleton-222"><span class="linenos">222</span></a>        <span class="n">parents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;node_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Skeleton-223"><a href="#Skeleton-223"><span class="linenos">223</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_root</span><span class="p">,</span> <span class="s2">&quot;parent_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Skeleton-224"><a href="#Skeleton-224"><span class="linenos">224</span></a>        <span class="p">]</span>
</span><span id="Skeleton-225"><a href="#Skeleton-225"><span class="linenos">225</span></a>
</span><span id="Skeleton-226"><a href="#Skeleton-226"><span class="linenos">226</span></a>        <span class="n">dists</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">parents</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Skeleton-227"><a href="#Skeleton-227"><span class="linenos">227</span></a>        <span class="n">dists</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">dists</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Skeleton-228"><a href="#Skeleton-228"><span class="linenos">228</span></a>
</span><span id="Skeleton-229"><a href="#Skeleton-229"><span class="linenos">229</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
</span><span id="Skeleton-230"><a href="#Skeleton-230"><span class="linenos">230</span></a>        <span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">node_id</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</span><span id="Skeleton-231"><a href="#Skeleton-231"><span class="linenos">231</span></a>        <span class="n">G</span><span class="o">.</span><span class="n">add_weighted_edges_from</span><span class="p">(</span>
</span><span id="Skeleton-232"><a href="#Skeleton-232"><span class="linenos">232</span></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">node_id</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dists</span><span class="p">)</span>
</span><span id="Skeleton-233"><a href="#Skeleton-233"><span class="linenos">233</span></a>        <span class="p">)</span>
</span><span id="Skeleton-234"><a href="#Skeleton-234"><span class="linenos">234</span></a>
</span><span id="Skeleton-235"><a href="#Skeleton-235"><span class="linenos">235</span></a>        <span class="k">return</span> <span class="n">G</span>
</span><span id="Skeleton-236"><a href="#Skeleton-236"><span class="linenos">236</span></a>
</span><span id="Skeleton-237"><a href="#Skeleton-237"><span class="linenos">237</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="n">return_lengths</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Skeleton-238"><a href="#Skeleton-238"><span class="linenos">238</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a list of linear segments while maximizing segment lengths.</span>
</span><span id="Skeleton-239"><a href="#Skeleton-239"><span class="linenos">239</span></a>
</span><span id="Skeleton-240"><a href="#Skeleton-240"><span class="linenos">240</span></a><span class="sd">        Parameters</span>
</span><span id="Skeleton-241"><a href="#Skeleton-241"><span class="linenos">241</span></a><span class="sd">        ----------</span>
</span><span id="Skeleton-242"><a href="#Skeleton-242"><span class="linenos">242</span></a><span class="sd">        weight :    &#39;weight&#39; | None, optional</span>
</span><span id="Skeleton-243"><a href="#Skeleton-243"><span class="linenos">243</span></a><span class="sd">                    If ``&quot;weight&quot;`` use physical, geodesic length to determine</span>
</span><span id="Skeleton-244"><a href="#Skeleton-244"><span class="linenos">244</span></a><span class="sd">                    segment length. If ``None`` use number of nodes (faster).</span>
</span><span id="Skeleton-245"><a href="#Skeleton-245"><span class="linenos">245</span></a><span class="sd">        return_lengths : bool</span>
</span><span id="Skeleton-246"><a href="#Skeleton-246"><span class="linenos">246</span></a><span class="sd">                    If True, also return lengths of segments according to ``weight``.</span>
</span><span id="Skeleton-247"><a href="#Skeleton-247"><span class="linenos">247</span></a>
</span><span id="Skeleton-248"><a href="#Skeleton-248"><span class="linenos">248</span></a><span class="sd">        Returns</span>
</span><span id="Skeleton-249"><a href="#Skeleton-249"><span class="linenos">249</span></a><span class="sd">        -------</span>
</span><span id="Skeleton-250"><a href="#Skeleton-250"><span class="linenos">250</span></a><span class="sd">        segments :  list</span>
</span><span id="Skeleton-251"><a href="#Skeleton-251"><span class="linenos">251</span></a><span class="sd">                    Segments as list of lists containing node IDs. List is</span>
</span><span id="Skeleton-252"><a href="#Skeleton-252"><span class="linenos">252</span></a><span class="sd">                    sorted by segment lengths.</span>
</span><span id="Skeleton-253"><a href="#Skeleton-253"><span class="linenos">253</span></a><span class="sd">        lengths :   list</span>
</span><span id="Skeleton-254"><a href="#Skeleton-254"><span class="linenos">254</span></a><span class="sd">                    Length for each segment according to ``weight``. Only provided</span>
</span><span id="Skeleton-255"><a href="#Skeleton-255"><span class="linenos">255</span></a><span class="sd">                    if `return_lengths` is True.</span>
</span><span id="Skeleton-256"><a href="#Skeleton-256"><span class="linenos">256</span></a>
</span><span id="Skeleton-257"><a href="#Skeleton-257"><span class="linenos">257</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Skeleton-258"><a href="#Skeleton-258"><span class="linenos">258</span></a>        <span class="k">assert</span> <span class="n">weight</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Unable to use weight &quot;</span><span class="si">{</span><span class="n">weight</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
</span><span id="Skeleton-259"><a href="#Skeleton-259"><span class="linenos">259</span></a>
</span><span id="Skeleton-260"><a href="#Skeleton-260"><span class="linenos">260</span></a>        <span class="c1"># Get graph representation</span>
</span><span id="Skeleton-261"><a href="#Skeleton-261"><span class="linenos">261</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span>
</span><span id="Skeleton-262"><a href="#Skeleton-262"><span class="linenos">262</span></a>
</span><span id="Skeleton-263"><a href="#Skeleton-263"><span class="linenos">263</span></a>        <span class="c1"># Get distances to root</span>
</span><span id="Skeleton-264"><a href="#Skeleton-264"><span class="linenos">264</span></a>        <span class="n">dists</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Skeleton-265"><a href="#Skeleton-265"><span class="linenos">265</span></a>        <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">node_id</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
</span><span id="Skeleton-266"><a href="#Skeleton-266"><span class="linenos">266</span></a>            <span class="n">dists</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">shortest_path_length</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">root</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">))</span>
</span><span id="Skeleton-267"><a href="#Skeleton-267"><span class="linenos">267</span></a>
</span><span id="Skeleton-268"><a href="#Skeleton-268"><span class="linenos">268</span></a>        <span class="c1"># Sort leaf nodes</span>
</span><span id="Skeleton-269"><a href="#Skeleton-269"><span class="linenos">269</span></a>        <span class="n">endNodeIDs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">leafs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">leafs</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">node_id</span><span class="o">.</span><span class="n">values</span>
</span><span id="Skeleton-270"><a href="#Skeleton-270"><span class="linenos">270</span></a>        <span class="n">endNodeIDs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">endNodeIDs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">dists</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Skeleton-271"><a href="#Skeleton-271"><span class="linenos">271</span></a>
</span><span id="Skeleton-272"><a href="#Skeleton-272"><span class="linenos">272</span></a>        <span class="n">seen</span><span class="p">:</span> <span class="nb">set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Skeleton-273"><a href="#Skeleton-273"><span class="linenos">273</span></a>        <span class="n">sequences</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Skeleton-274"><a href="#Skeleton-274"><span class="linenos">274</span></a>        <span class="k">for</span> <span class="n">nodeID</span> <span class="ow">in</span> <span class="n">endNodeIDs</span><span class="p">:</span>
</span><span id="Skeleton-275"><a href="#Skeleton-275"><span class="linenos">275</span></a>            <span class="n">sequence</span> <span class="o">=</span> <span class="p">[</span><span class="n">nodeID</span><span class="p">]</span>
</span><span id="Skeleton-276"><a href="#Skeleton-276"><span class="linenos">276</span></a>            <span class="n">parents</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">nodeID</span><span class="p">))</span>
</span><span id="Skeleton-277"><a href="#Skeleton-277"><span class="linenos">277</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Skeleton-278"><a href="#Skeleton-278"><span class="linenos">278</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">parents</span><span class="p">:</span>
</span><span id="Skeleton-279"><a href="#Skeleton-279"><span class="linenos">279</span></a>                    <span class="k">break</span>
</span><span id="Skeleton-280"><a href="#Skeleton-280"><span class="linenos">280</span></a>                <span class="n">parentID</span> <span class="o">=</span> <span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Skeleton-281"><a href="#Skeleton-281"><span class="linenos">281</span></a>                <span class="n">sequence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parentID</span><span class="p">)</span>
</span><span id="Skeleton-282"><a href="#Skeleton-282"><span class="linenos">282</span></a>                <span class="k">if</span> <span class="n">parentID</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
</span><span id="Skeleton-283"><a href="#Skeleton-283"><span class="linenos">283</span></a>                    <span class="k">break</span>
</span><span id="Skeleton-284"><a href="#Skeleton-284"><span class="linenos">284</span></a>                <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">parentID</span><span class="p">)</span>
</span><span id="Skeleton-285"><a href="#Skeleton-285"><span class="linenos">285</span></a>                <span class="n">parents</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">parentID</span><span class="p">))</span>
</span><span id="Skeleton-286"><a href="#Skeleton-286"><span class="linenos">286</span></a>
</span><span id="Skeleton-287"><a href="#Skeleton-287"><span class="linenos">287</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Skeleton-288"><a href="#Skeleton-288"><span class="linenos">288</span></a>                <span class="n">sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
</span><span id="Skeleton-289"><a href="#Skeleton-289"><span class="linenos">289</span></a>
</span><span id="Skeleton-290"><a href="#Skeleton-290"><span class="linenos">290</span></a>        <span class="c1"># Sort sequences by length</span>
</span><span id="Skeleton-291"><a href="#Skeleton-291"><span class="linenos">291</span></a>        <span class="n">lengths</span> <span class="o">=</span> <span class="p">[</span><span class="n">dists</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="n">dists</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">]</span>
</span><span id="Skeleton-292"><a href="#Skeleton-292"><span class="linenos">292</span></a>        <span class="n">sequences</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">lengths</span><span class="p">,</span> <span class="n">sequences</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
</span><span id="Skeleton-293"><a href="#Skeleton-293"><span class="linenos">293</span></a>
</span><span id="Skeleton-294"><a href="#Skeleton-294"><span class="linenos">294</span></a>        <span class="k">if</span> <span class="n">return_lengths</span><span class="p">:</span>
</span><span id="Skeleton-295"><a href="#Skeleton-295"><span class="linenos">295</span></a>            <span class="k">return</span> <span class="n">sequences</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lengths</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Skeleton-296"><a href="#Skeleton-296"><span class="linenos">296</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Skeleton-297"><a href="#Skeleton-297"><span class="linenos">297</span></a>            <span class="k">return</span> <span class="n">sequences</span>
</span><span id="Skeleton-298"><a href="#Skeleton-298"><span class="linenos">298</span></a>
</span><span id="Skeleton-299"><a href="#Skeleton-299"><span class="linenos">299</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_swc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
</span><span id="Skeleton-300"><a href="#Skeleton-300"><span class="linenos">300</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save skeleton in SWC format.</span>
</span><span id="Skeleton-301"><a href="#Skeleton-301"><span class="linenos">301</span></a>
</span><span id="Skeleton-302"><a href="#Skeleton-302"><span class="linenos">302</span></a><span class="sd">        Parameters</span>
</span><span id="Skeleton-303"><a href="#Skeleton-303"><span class="linenos">303</span></a><span class="sd">        ----------</span>
</span><span id="Skeleton-304"><a href="#Skeleton-304"><span class="linenos">304</span></a><span class="sd">        filepath :      path-like</span>
</span><span id="Skeleton-305"><a href="#Skeleton-305"><span class="linenos">305</span></a><span class="sd">                        Filepath to save SWC to.</span>
</span><span id="Skeleton-306"><a href="#Skeleton-306"><span class="linenos">306</span></a>
</span><span id="Skeleton-307"><a href="#Skeleton-307"><span class="linenos">307</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Skeleton-308"><a href="#Skeleton-308"><span class="linenos">308</span></a>        <span class="n">header</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
</span><span id="Skeleton-309"><a href="#Skeleton-309"><span class="linenos">309</span></a><span class="s2">        # SWC format file</span>
</span><span id="Skeleton-310"><a href="#Skeleton-310"><span class="linenos">310</span></a><span class="s2">        # based on specifications at http://www.neuronland.org/NLMorphologyConverter/MorphologyFormats/SWC/Spec.html</span>
</span><span id="Skeleton-311"><a href="#Skeleton-311"><span class="linenos">311</span></a><span class="s2">        # Created on </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="si">}</span><span class="s2"> using skeletor (https://github.com/navis-org/skeletor)</span>
</span><span id="Skeleton-312"><a href="#Skeleton-312"><span class="linenos">312</span></a><span class="s2">        # PointNo Label X Y Z Radius Parent</span>
</span><span id="Skeleton-313"><a href="#Skeleton-313"><span class="linenos">313</span></a><span class="s2">        # Labels:</span>
</span><span id="Skeleton-314"><a href="#Skeleton-314"><span class="linenos">314</span></a><span class="s2">        # 0 = undefined, 1 = soma, 5 = fork point, 6 = end point</span>
</span><span id="Skeleton-315"><a href="#Skeleton-315"><span class="linenos">315</span></a><span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="Skeleton-316"><a href="#Skeleton-316"><span class="linenos">316</span></a>
</span><span id="Skeleton-317"><a href="#Skeleton-317"><span class="linenos">317</span></a>        <span class="c1"># Make copy of SWC table</span>
</span><span id="Skeleton-318"><a href="#Skeleton-318"><span class="linenos">318</span></a>        <span class="n">swc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Skeleton-319"><a href="#Skeleton-319"><span class="linenos">319</span></a>
</span><span id="Skeleton-320"><a href="#Skeleton-320"><span class="linenos">320</span></a>        <span class="c1"># Set all labels to undefined</span>
</span><span id="Skeleton-321"><a href="#Skeleton-321"><span class="linenos">321</span></a>        <span class="n">swc</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Skeleton-322"><a href="#Skeleton-322"><span class="linenos">322</span></a>        <span class="n">swc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">swc</span><span class="o">.</span><span class="n">node_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">swc</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
</span><span id="Skeleton-323"><a href="#Skeleton-323"><span class="linenos">323</span></a>        <span class="n">n_childs</span> <span class="o">=</span> <span class="n">swc</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;parent_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="Skeleton-324"><a href="#Skeleton-324"><span class="linenos">324</span></a>        <span class="n">bp</span> <span class="o">=</span> <span class="n">n_childs</span><span class="p">[</span><span class="n">n_childs</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
</span><span id="Skeleton-325"><a href="#Skeleton-325"><span class="linenos">325</span></a>        <span class="n">swc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">swc</span><span class="o">.</span><span class="n">node_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">bp</span><span class="p">),</span> <span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Skeleton-326"><a href="#Skeleton-326"><span class="linenos">326</span></a>
</span><span id="Skeleton-327"><a href="#Skeleton-327"><span class="linenos">327</span></a>        <span class="c1"># Add radius if missing</span>
</span><span id="Skeleton-328"><a href="#Skeleton-328"><span class="linenos">328</span></a>        <span class="k">if</span> <span class="s2">&quot;radius&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">swc</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="Skeleton-329"><a href="#Skeleton-329"><span class="linenos">329</span></a>            <span class="n">swc</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Skeleton-330"><a href="#Skeleton-330"><span class="linenos">330</span></a>
</span><span id="Skeleton-331"><a href="#Skeleton-331"><span class="linenos">331</span></a>        <span class="c1"># Get things in order</span>
</span><span id="Skeleton-332"><a href="#Skeleton-332"><span class="linenos">332</span></a>        <span class="n">swc</span> <span class="o">=</span> <span class="n">swc</span><span class="p">[[</span><span class="s2">&quot;node_id&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="s2">&quot;parent_id&quot;</span><span class="p">]]</span>
</span><span id="Skeleton-333"><a href="#Skeleton-333"><span class="linenos">333</span></a>
</span><span id="Skeleton-334"><a href="#Skeleton-334"><span class="linenos">334</span></a>        <span class="c1"># Adjust column titles</span>
</span><span id="Skeleton-335"><a href="#Skeleton-335"><span class="linenos">335</span></a>        <span class="n">swc</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;PointNo&quot;</span><span class="p">,</span> <span class="s2">&quot;Label&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;Radius&quot;</span><span class="p">,</span> <span class="s2">&quot;Parent&quot;</span><span class="p">]</span>
</span><span id="Skeleton-336"><a href="#Skeleton-336"><span class="linenos">336</span></a>
</span><span id="Skeleton-337"><a href="#Skeleton-337"><span class="linenos">337</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="Skeleton-338"><a href="#Skeleton-338"><span class="linenos">338</span></a>            <span class="c1"># Write header</span>
</span><span id="Skeleton-339"><a href="#Skeleton-339"><span class="linenos">339</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
</span><span id="Skeleton-340"><a href="#Skeleton-340"><span class="linenos">340</span></a>
</span><span id="Skeleton-341"><a href="#Skeleton-341"><span class="linenos">341</span></a>            <span class="c1"># Write data</span>
</span><span id="Skeleton-342"><a href="#Skeleton-342"><span class="linenos">342</span></a>            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="Skeleton-343"><a href="#Skeleton-343"><span class="linenos">343</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">swc</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</span><span id="Skeleton-344"><a href="#Skeleton-344"><span class="linenos">344</span></a>
</span><span id="Skeleton-345"><a href="#Skeleton-345"><span class="linenos">345</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scene</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Skeleton-346"><a href="#Skeleton-346"><span class="linenos">346</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a Scene object containing the skeleton.</span>
</span><span id="Skeleton-347"><a href="#Skeleton-347"><span class="linenos">347</span></a>
</span><span id="Skeleton-348"><a href="#Skeleton-348"><span class="linenos">348</span></a><span class="sd">        Returns</span>
</span><span id="Skeleton-349"><a href="#Skeleton-349"><span class="linenos">349</span></a><span class="sd">        -------</span>
</span><span id="Skeleton-350"><a href="#Skeleton-350"><span class="linenos">350</span></a><span class="sd">        scene :     trimesh.scene.scene.Scene</span>
</span><span id="Skeleton-351"><a href="#Skeleton-351"><span class="linenos">351</span></a><span class="sd">                    Contains the skeleton and optionally the mesh.</span>
</span><span id="Skeleton-352"><a href="#Skeleton-352"><span class="linenos">352</span></a>
</span><span id="Skeleton-353"><a href="#Skeleton-353"><span class="linenos">353</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Skeleton-354"><a href="#Skeleton-354"><span class="linenos">354</span></a>        <span class="k">if</span> <span class="n">mesh</span><span class="p">:</span>
</span><span id="Skeleton-355"><a href="#Skeleton-355"><span class="linenos">355</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
</span><span id="Skeleton-356"><a href="#Skeleton-356"><span class="linenos">356</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Skeleton has no mesh.&quot;</span><span class="p">)</span>
</span><span id="Skeleton-357"><a href="#Skeleton-357"><span class="linenos">357</span></a>
</span><span id="Skeleton-358"><a href="#Skeleton-358"><span class="linenos">358</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">visual</span><span class="o">.</span><span class="n">face_colors</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
</span><span id="Skeleton-359"><a href="#Skeleton-359"><span class="linenos">359</span></a>
</span><span id="Skeleton-360"><a href="#Skeleton-360"><span class="linenos">360</span></a>            <span class="c1"># Note the copy(): without it the transform in show() changes</span>
</span><span id="Skeleton-361"><a href="#Skeleton-361"><span class="linenos">361</span></a>            <span class="c1"># the original meshes</span>
</span><span id="Skeleton-362"><a href="#Skeleton-362"><span class="linenos">362</span></a>            <span class="n">sc</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">Scene</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">skeleton</span><span class="o">.</span><span class="n">copy</span><span class="p">()],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Skeleton-363"><a href="#Skeleton-363"><span class="linenos">363</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Skeleton-364"><a href="#Skeleton-364"><span class="linenos">364</span></a>            <span class="n">sc</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skeleton</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Skeleton-365"><a href="#Skeleton-365"><span class="linenos">365</span></a>
</span><span id="Skeleton-366"><a href="#Skeleton-366"><span class="linenos">366</span></a>        <span class="k">return</span> <span class="n">sc</span>
</span><span id="Skeleton-367"><a href="#Skeleton-367"><span class="linenos">367</span></a>
</span><span id="Skeleton-368"><a href="#Skeleton-368"><span class="linenos">368</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Skeleton-369"><a href="#Skeleton-369"><span class="linenos">369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Render the skeleton in an opengl window. Requires pyglet.</span>
</span><span id="Skeleton-370"><a href="#Skeleton-370"><span class="linenos">370</span></a>
</span><span id="Skeleton-371"><a href="#Skeleton-371"><span class="linenos">371</span></a><span class="sd">        Parameters</span>
</span><span id="Skeleton-372"><a href="#Skeleton-372"><span class="linenos">372</span></a><span class="sd">        ----------</span>
</span><span id="Skeleton-373"><a href="#Skeleton-373"><span class="linenos">373</span></a><span class="sd">        mesh :      bool</span>
</span><span id="Skeleton-374"><a href="#Skeleton-374"><span class="linenos">374</span></a><span class="sd">                    If True, will render transparent mesh on top of the</span>
</span><span id="Skeleton-375"><a href="#Skeleton-375"><span class="linenos">375</span></a><span class="sd">                    skeleton.</span>
</span><span id="Skeleton-376"><a href="#Skeleton-376"><span class="linenos">376</span></a>
</span><span id="Skeleton-377"><a href="#Skeleton-377"><span class="linenos">377</span></a><span class="sd">        Returns</span>
</span><span id="Skeleton-378"><a href="#Skeleton-378"><span class="linenos">378</span></a><span class="sd">        --------</span>
</span><span id="Skeleton-379"><a href="#Skeleton-379"><span class="linenos">379</span></a><span class="sd">        scene :     trimesh.scene.Scene</span>
</span><span id="Skeleton-380"><a href="#Skeleton-380"><span class="linenos">380</span></a><span class="sd">                    Scene with skeleton in it.</span>
</span><span id="Skeleton-381"><a href="#Skeleton-381"><span class="linenos">381</span></a>
</span><span id="Skeleton-382"><a href="#Skeleton-382"><span class="linenos">382</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Skeleton-383"><a href="#Skeleton-383"><span class="linenos">383</span></a>        <span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">)</span>
</span><span id="Skeleton-384"><a href="#Skeleton-384"><span class="linenos">384</span></a>
</span><span id="Skeleton-385"><a href="#Skeleton-385"><span class="linenos">385</span></a>        <span class="c1"># I encountered some issues if object space is big and the easiest</span>
</span><span id="Skeleton-386"><a href="#Skeleton-386"><span class="linenos">386</span></a>        <span class="c1"># way to work around this is to apply a transform such that the</span>
</span><span id="Skeleton-387"><a href="#Skeleton-387"><span class="linenos">387</span></a>        <span class="c1"># coordinates have -5 to +5 bounds</span>
</span><span id="Skeleton-388"><a href="#Skeleton-388"><span class="linenos">388</span></a>        <span class="n">fac</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skeleton</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Skeleton-389"><a href="#Skeleton-389"><span class="linenos">389</span></a>        <span class="n">scene</span><span class="o">.</span><span class="n">apply_transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="n">fac</span><span class="p">,</span> <span class="n">fac</span><span class="p">,</span> <span class="n">fac</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="Skeleton-390"><a href="#Skeleton-390"><span class="linenos">390</span></a>
</span><span id="Skeleton-391"><a href="#Skeleton-391"><span class="linenos">391</span></a>        <span class="k">return</span> <span class="n">scene</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Skeleton-392"><a href="#Skeleton-392"><span class="linenos">392</span></a>
</span><span id="Skeleton-393"><a href="#Skeleton-393"><span class="linenos">393</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mend_breaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist_mult</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">dist_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dist_max</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">):</span>
</span><span id="Skeleton-394"><a href="#Skeleton-394"><span class="linenos">394</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Mend breaks in the skeleton using the original mesh.</span>
</span><span id="Skeleton-395"><a href="#Skeleton-395"><span class="linenos">395</span></a>
</span><span id="Skeleton-396"><a href="#Skeleton-396"><span class="linenos">396</span></a><span class="sd">        This works by comparing the connectivity of the original mesh with that</span>
</span><span id="Skeleton-397"><a href="#Skeleton-397"><span class="linenos">397</span></a><span class="sd">        of the skeleton. If the shortest path between two adjacent vertices on the mesh</span>
</span><span id="Skeleton-398"><a href="#Skeleton-398"><span class="linenos">398</span></a><span class="sd">        is shorter than the distance between the nodes in the skeleton, a new edge</span>
</span><span id="Skeleton-399"><a href="#Skeleton-399"><span class="linenos">399</span></a><span class="sd">        is added to the skeleton.</span>
</span><span id="Skeleton-400"><a href="#Skeleton-400"><span class="linenos">400</span></a>
</span><span id="Skeleton-401"><a href="#Skeleton-401"><span class="linenos">401</span></a><span class="sd">        Parameters</span>
</span><span id="Skeleton-402"><a href="#Skeleton-402"><span class="linenos">402</span></a><span class="sd">        ----------</span>
</span><span id="Skeleton-403"><a href="#Skeleton-403"><span class="linenos">403</span></a><span class="sd">        dist_mult : float, optional</span>
</span><span id="Skeleton-404"><a href="#Skeleton-404"><span class="linenos">404</span></a><span class="sd">                    Factor by which the new edge should be shorter than the</span>
</span><span id="Skeleton-405"><a href="#Skeleton-405"><span class="linenos">405</span></a><span class="sd">                    current shortest path between two nodes to be added.</span>
</span><span id="Skeleton-406"><a href="#Skeleton-406"><span class="linenos">406</span></a><span class="sd">                    Lower values = fewer false negatives; higher values = fewer</span>
</span><span id="Skeleton-407"><a href="#Skeleton-407"><span class="linenos">407</span></a><span class="sd">                    false positive edges.</span>
</span><span id="Skeleton-408"><a href="#Skeleton-408"><span class="linenos">408</span></a><span class="sd">        dist_min :  float, optional</span>
</span><span id="Skeleton-409"><a href="#Skeleton-409"><span class="linenos">409</span></a><span class="sd">                    Minimum distance between nodes to consider adding an edge.</span>
</span><span id="Skeleton-410"><a href="#Skeleton-410"><span class="linenos">410</span></a><span class="sd">                    Use this to avoid adding very short edges.</span>
</span><span id="Skeleton-411"><a href="#Skeleton-411"><span class="linenos">411</span></a><span class="sd">        dist_max :  float, optional</span>
</span><span id="Skeleton-412"><a href="#Skeleton-412"><span class="linenos">412</span></a><span class="sd">                    Maximum distance between nodes to consider adding an edge.</span>
</span><span id="Skeleton-413"><a href="#Skeleton-413"><span class="linenos">413</span></a><span class="sd">                    Use this to avoid adding very long edges.</span>
</span><span id="Skeleton-414"><a href="#Skeleton-414"><span class="linenos">414</span></a>
</span><span id="Skeleton-415"><a href="#Skeleton-415"><span class="linenos">415</span></a><span class="sd">        Returns</span>
</span><span id="Skeleton-416"><a href="#Skeleton-416"><span class="linenos">416</span></a><span class="sd">        -------</span>
</span><span id="Skeleton-417"><a href="#Skeleton-417"><span class="linenos">417</span></a><span class="sd">        edges :     (N, 2) array</span>
</span><span id="Skeleton-418"><a href="#Skeleton-418"><span class="linenos">418</span></a><span class="sd">                    Edges connecting the skeleton nodes.</span>
</span><span id="Skeleton-419"><a href="#Skeleton-419"><span class="linenos">419</span></a><span class="sd">        vertices :  (N, 3) array</span>
</span><span id="Skeleton-420"><a href="#Skeleton-420"><span class="linenos">420</span></a><span class="sd">                    Positions of the skeleton nodes.</span>
</span><span id="Skeleton-421"><a href="#Skeleton-421"><span class="linenos">421</span></a>
</span><span id="Skeleton-422"><a href="#Skeleton-422"><span class="linenos">422</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Skeleton-423"><a href="#Skeleton-423"><span class="linenos">423</span></a>        <span class="c1"># We need `.mesh_map` and `.mesh` to exist</span>
</span><span id="Skeleton-424"><a href="#Skeleton-424"><span class="linenos">424</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Skeleton-425"><a href="#Skeleton-425"><span class="linenos">425</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Skeleton must have a `mesh_map` to mend breaks.&quot;</span><span class="p">)</span>
</span><span id="Skeleton-426"><a href="#Skeleton-426"><span class="linenos">426</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Skeleton-427"><a href="#Skeleton-427"><span class="linenos">427</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Skeleton must have a `mesh` to mend breaks.&quot;</span><span class="p">)</span>
</span><span id="Skeleton-428"><a href="#Skeleton-428"><span class="linenos">428</span></a>
</span><span id="Skeleton-429"><a href="#Skeleton-429"><span class="linenos">429</span></a>        <span class="c1"># Make a copy of the mesh edges</span>
</span><span id="Skeleton-430"><a href="#Skeleton-430"><span class="linenos">430</span></a>        <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Skeleton-431"><a href="#Skeleton-431"><span class="linenos">431</span></a>        <span class="c1"># Map mesh vertices to skeleton vertices</span>
</span><span id="Skeleton-432"><a href="#Skeleton-432"><span class="linenos">432</span></a>        <span class="n">edges</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]]</span>
</span><span id="Skeleton-433"><a href="#Skeleton-433"><span class="linenos">433</span></a>        <span class="n">edges</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
</span><span id="Skeleton-434"><a href="#Skeleton-434"><span class="linenos">434</span></a>        <span class="c1"># Deduplicate</span>
</span><span id="Skeleton-435"><a href="#Skeleton-435"><span class="linenos">435</span></a>        <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Skeleton-436"><a href="#Skeleton-436"><span class="linenos">436</span></a>        <span class="c1"># Remove self edges</span>
</span><span id="Skeleton-437"><a href="#Skeleton-437"><span class="linenos">437</span></a>        <span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="n">edges</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">edges</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
</span><span id="Skeleton-438"><a href="#Skeleton-438"><span class="linenos">438</span></a>
</span><span id="Skeleton-439"><a href="#Skeleton-439"><span class="linenos">439</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">to_undirected</span><span class="p">()</span>
</span><span id="Skeleton-440"><a href="#Skeleton-440"><span class="linenos">440</span></a>
</span><span id="Skeleton-441"><a href="#Skeleton-441"><span class="linenos">441</span></a>        <span class="c1"># Remove edges that are already in the skeleton</span>
</span><span id="Skeleton-442"><a href="#Skeleton-442"><span class="linenos">442</span></a>        <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edges</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">G</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">)])</span>
</span><span id="Skeleton-443"><a href="#Skeleton-443"><span class="linenos">443</span></a>
</span><span id="Skeleton-444"><a href="#Skeleton-444"><span class="linenos">444</span></a>        <span class="c1"># Calculate distance between these new edge candidates</span>
</span><span id="Skeleton-445"><a href="#Skeleton-445"><span class="linenos">445</span></a>        <span class="n">dists</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
</span><span id="Skeleton-446"><a href="#Skeleton-446"><span class="linenos">446</span></a>            <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">edges</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">edges</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Skeleton-447"><a href="#Skeleton-447"><span class="linenos">447</span></a>        <span class="p">)</span>
</span><span id="Skeleton-448"><a href="#Skeleton-448"><span class="linenos">448</span></a>
</span><span id="Skeleton-449"><a href="#Skeleton-449"><span class="linenos">449</span></a>        <span class="c1"># Sort by distance (lowest first)</span>
</span><span id="Skeleton-450"><a href="#Skeleton-450"><span class="linenos">450</span></a>        <span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">dists</span><span class="p">)]</span>
</span><span id="Skeleton-451"><a href="#Skeleton-451"><span class="linenos">451</span></a>        <span class="n">dists</span> <span class="o">=</span> <span class="n">dists</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">dists</span><span class="p">)]</span>
</span><span id="Skeleton-452"><a href="#Skeleton-452"><span class="linenos">452</span></a>
</span><span id="Skeleton-453"><a href="#Skeleton-453"><span class="linenos">453</span></a>        <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">dists</span><span class="p">):</span>
</span><span id="Skeleton-454"><a href="#Skeleton-454"><span class="linenos">454</span></a>            <span class="c1"># Check if the new path would be shorter than the current shortest path</span>
</span><span id="Skeleton-455"><a href="#Skeleton-455"><span class="linenos">455</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">dist_mult</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path_length</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Skeleton-456"><a href="#Skeleton-456"><span class="linenos">456</span></a>                <span class="k">continue</span>
</span><span id="Skeleton-457"><a href="#Skeleton-457"><span class="linenos">457</span></a>            <span class="c1"># Check if the distance is within bounds</span>
</span><span id="Skeleton-458"><a href="#Skeleton-458"><span class="linenos">458</span></a>            <span class="k">elif</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">dist_min</span><span class="p">:</span>
</span><span id="Skeleton-459"><a href="#Skeleton-459"><span class="linenos">459</span></a>                <span class="k">continue</span>
</span><span id="Skeleton-460"><a href="#Skeleton-460"><span class="linenos">460</span></a>            <span class="k">elif</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="n">dist_max</span><span class="p">:</span>
</span><span id="Skeleton-461"><a href="#Skeleton-461"><span class="linenos">461</span></a>                <span class="k">continue</span>
</span><span id="Skeleton-462"><a href="#Skeleton-462"><span class="linenos">462</span></a>            <span class="c1"># Add edge</span>
</span><span id="Skeleton-463"><a href="#Skeleton-463"><span class="linenos">463</span></a>            <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
</span><span id="Skeleton-464"><a href="#Skeleton-464"><span class="linenos">464</span></a>
</span><span id="Skeleton-465"><a href="#Skeleton-465"><span class="linenos">465</span></a>        <span class="c1"># The above may have introduced small triangles which we should try to remove</span>
</span><span id="Skeleton-466"><a href="#Skeleton-466"><span class="linenos">466</span></a>        <span class="c1"># by removing the longest edge in a triangle. I have also spotted more</span>
</span><span id="Skeleton-467"><a href="#Skeleton-467"><span class="linenos">467</span></a>        <span class="c1"># complex cases of four or more nodes forming false-positive loops but</span>
</span><span id="Skeleton-468"><a href="#Skeleton-468"><span class="linenos">468</span></a>        <span class="c1"># these will be harder to detect and remove.</span>
</span><span id="Skeleton-469"><a href="#Skeleton-469"><span class="linenos">469</span></a>
</span><span id="Skeleton-470"><a href="#Skeleton-470"><span class="linenos">470</span></a>        <span class="c1"># First collect neighbors for each node</span>
</span><span id="Skeleton-471"><a href="#Skeleton-471"><span class="linenos">471</span></a>        <span class="n">later_nbrs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Skeleton-472"><a href="#Skeleton-472"><span class="linenos">472</span></a>        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">neighbors</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">adjacency</span><span class="p">():</span>
</span><span id="Skeleton-473"><a href="#Skeleton-473"><span class="linenos">473</span></a>            <span class="n">later_nbrs</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Skeleton-474"><a href="#Skeleton-474"><span class="linenos">474</span></a>                <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">neighbors</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">later_nbrs</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">node</span>
</span><span id="Skeleton-475"><a href="#Skeleton-475"><span class="linenos">475</span></a>            <span class="p">}</span>
</span><span id="Skeleton-476"><a href="#Skeleton-476"><span class="linenos">476</span></a>
</span><span id="Skeleton-477"><a href="#Skeleton-477"><span class="linenos">477</span></a>        <span class="c1"># Go over each node</span>
</span><span id="Skeleton-478"><a href="#Skeleton-478"><span class="linenos">478</span></a>        <span class="n">triangles</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Skeleton-479"><a href="#Skeleton-479"><span class="linenos">479</span></a>        <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">neighbors</span> <span class="ow">in</span> <span class="n">later_nbrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Skeleton-480"><a href="#Skeleton-480"><span class="linenos">480</span></a>            <span class="c1"># Go over each neighbor</span>
</span><span id="Skeleton-481"><a href="#Skeleton-481"><span class="linenos">481</span></a>            <span class="k">for</span> <span class="n">node2</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">:</span>
</span><span id="Skeleton-482"><a href="#Skeleton-482"><span class="linenos">482</span></a>                <span class="c1"># Check if there is one or more third nodes that are connected to both</span>
</span><span id="Skeleton-483"><a href="#Skeleton-483"><span class="linenos">483</span></a>                <span class="n">third_nodes</span> <span class="o">=</span> <span class="n">neighbors</span> <span class="o">&amp;</span> <span class="n">later_nbrs</span><span class="p">[</span><span class="n">node2</span><span class="p">]</span>
</span><span id="Skeleton-484"><a href="#Skeleton-484"><span class="linenos">484</span></a>                <span class="k">for</span> <span class="n">node3</span> <span class="ow">in</span> <span class="n">third_nodes</span><span class="p">:</span>
</span><span id="Skeleton-485"><a href="#Skeleton-485"><span class="linenos">485</span></a>                    <span class="c1"># Add triangle (sort to deduplicate)</span>
</span><span id="Skeleton-486"><a href="#Skeleton-486"><span class="linenos">486</span></a>                    <span class="n">triangles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">([</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">node3</span><span class="p">])))</span>
</span><span id="Skeleton-487"><a href="#Skeleton-487"><span class="linenos">487</span></a>
</span><span id="Skeleton-488"><a href="#Skeleton-488"><span class="linenos">488</span></a>        <span class="c1"># Remove longest edge in each triangle</span>
</span><span id="Skeleton-489"><a href="#Skeleton-489"><span class="linenos">489</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">triangles</span><span class="p">:</span>
</span><span id="Skeleton-490"><a href="#Skeleton-490"><span class="linenos">490</span></a>            <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span> <span class="o">=</span> <span class="n">t</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">t</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Skeleton-491"><a href="#Skeleton-491"><span class="linenos">491</span></a>            <span class="c1"># Make sure all edges still exist (we may have already removed edges</span>
</span><span id="Skeleton-492"><a href="#Skeleton-492"><span class="linenos">492</span></a>            <span class="c1"># that were part of a previous triangle)</span>
</span><span id="Skeleton-493"><a href="#Skeleton-493"><span class="linenos">493</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">G</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">)):</span>
</span><span id="Skeleton-494"><a href="#Skeleton-494"><span class="linenos">494</span></a>                <span class="k">continue</span>
</span><span id="Skeleton-495"><a href="#Skeleton-495"><span class="linenos">495</span></a>            <span class="c1"># Remove the longest edge</span>
</span><span id="Skeleton-496"><a href="#Skeleton-496"><span class="linenos">496</span></a>            <span class="n">G</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="o">*</span><span class="nb">max</span><span class="p">((</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">]))</span>
</span><span id="Skeleton-497"><a href="#Skeleton-497"><span class="linenos">497</span></a>
</span><span id="Skeleton-498"><a href="#Skeleton-498"><span class="linenos">498</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Class representing a skeleton.</p>

<p>Typically returned as results from a skeletonization.</p>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>swc</strong> (pd.DataFrame, optional):
SWC table.</li>
<li><strong>vertices</strong> ((N, 3) array):
Vertex (node) positions.</li>
<li><strong>edges</strong> ((M, 2) array):
Indices of connected vertex pairs.</li>
<li><strong>radii</strong> ((N, ) array, optional):
Radii for each vertex (node) in the skeleton.</li>
<li><strong>mesh</strong> (trimesh, optional):
The original mesh.</li>
<li><strong>mesh_map</strong> (array, optional):
Same length as <code><a href="#Skeleton.mesh">mesh</a></code>. Maps mesh vertices to vertices (nodes)
in the skeleton.</li>
<li><strong>skel_map</strong> (array of arrays, optional):
Inverse of <code><a href="#Skeleton.mesh_map">mesh_map</a></code>: maps skeleton vertices (nodes) to mesh
vertices.</li>
<li><strong>method</strong> (str, optional):
Which method was used to generate the skeleton.</li>
</ul>
</div>


                            <div id="Skeleton.__init__" class="classattr">
                                        <input id="Skeleton.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Skeleton</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">swc</span>, </span><span class="param"><span class="n">mesh</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">mesh_map</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">method</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="Skeleton.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Skeleton.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Skeleton.__init__-61"><a href="#Skeleton.__init__-61"><span class="linenos">61</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">swc</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mesh_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Skeleton.__init__-62"><a href="#Skeleton.__init__-62"><span class="linenos">62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">swc</span> <span class="o">=</span> <span class="n">swc</span>
</span><span id="Skeleton.__init__-63"><a href="#Skeleton.__init__-63"><span class="linenos">63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span>
</span><span id="Skeleton.__init__-64"><a href="#Skeleton.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_map</span> <span class="o">=</span> <span class="n">mesh_map</span>
</span><span id="Skeleton.__init__-65"><a href="#Skeleton.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
</span></pre></div>


    

                            </div>
                            <div id="Skeleton.swc" class="classattr">
                                <div class="attr variable">
            <span class="name">swc</span>

        
    </div>
    <a class="headerlink" href="#Skeleton.swc"></a>
    
    

                            </div>
                            <div id="Skeleton.mesh" class="classattr">
                                <div class="attr variable">
            <span class="name">mesh</span>

        
    </div>
    <a class="headerlink" href="#Skeleton.mesh"></a>
    
    

                            </div>
                            <div id="Skeleton.mesh_map" class="classattr">
                                <div class="attr variable">
            <span class="name">mesh_map</span>

        
    </div>
    <a class="headerlink" href="#Skeleton.mesh_map"></a>
    
    

                            </div>
                            <div id="Skeleton.method" class="classattr">
                                <div class="attr variable">
            <span class="name">method</span>

        
    </div>
    <a class="headerlink" href="#Skeleton.method"></a>
    
    

                            </div>
                            <div id="Skeleton.edges" class="classattr">
                                        <input id="Skeleton.edges-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">edges</span>

                <label class="view-source-button" for="Skeleton.edges-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Skeleton.edges"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Skeleton.edges-82"><a href="#Skeleton.edges-82"><span class="linenos">82</span></a>    <span class="nd">@property</span>
</span><span id="Skeleton.edges-83"><a href="#Skeleton.edges-83"><span class="linenos">83</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton.edges-84"><a href="#Skeleton.edges-84"><span class="linenos">84</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return skeleton edges.&quot;&quot;&quot;</span>
</span><span id="Skeleton.edges-85"><a href="#Skeleton.edges-85"><span class="linenos">85</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;node_id&quot;</span><span class="p">,</span> <span class="s2">&quot;parent_id&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</span></pre></div>


            <div class="docstring"><p>Return skeleton edges.</p>
</div>


                            </div>
                            <div id="Skeleton.vertices" class="classattr">
                                        <input id="Skeleton.vertices-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">vertices</span>

                <label class="view-source-button" for="Skeleton.vertices-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Skeleton.vertices"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Skeleton.vertices-87"><a href="#Skeleton.vertices-87"><span class="linenos">87</span></a>    <span class="nd">@property</span>
</span><span id="Skeleton.vertices-88"><a href="#Skeleton.vertices-88"><span class="linenos">88</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton.vertices-89"><a href="#Skeleton.vertices-89"><span class="linenos">89</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return skeleton vertices (nodes).&quot;&quot;&quot;</span>
</span><span id="Skeleton.vertices-90"><a href="#Skeleton.vertices-90"><span class="linenos">90</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</span></pre></div>


            <div class="docstring"><p>Return skeleton vertices (nodes).</p>
</div>


                            </div>
                            <div id="Skeleton.radius" class="classattr">
                                        <input id="Skeleton.radius-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">radius</span>

                <label class="view-source-button" for="Skeleton.radius-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Skeleton.radius"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Skeleton.radius-92"><a href="#Skeleton.radius-92"><span class="linenos">92</span></a>    <span class="nd">@property</span>
</span><span id="Skeleton.radius-93"><a href="#Skeleton.radius-93"><span class="linenos">93</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton.radius-94"><a href="#Skeleton.radius-94"><span class="linenos">94</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return radii.&quot;&quot;&quot;</span>
</span><span id="Skeleton.radius-95"><a href="#Skeleton.radius-95"><span class="linenos">95</span></a>        <span class="k">if</span> <span class="s2">&quot;radius&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="Skeleton.radius-96"><a href="#Skeleton.radius-96"><span class="linenos">96</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Skeleton.radius-97"><a href="#Skeleton.radius-97"><span class="linenos">97</span></a>                <span class="s2">&quot;No radius info found. Run `skeletor.post.radii()`&quot;</span> <span class="s2">&quot; to get them.&quot;</span>
</span><span id="Skeleton.radius-98"><a href="#Skeleton.radius-98"><span class="linenos">98</span></a>            <span class="p">)</span>
</span><span id="Skeleton.radius-99"><a href="#Skeleton.radius-99"><span class="linenos">99</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span></pre></div>


            <div class="docstring"><p>Return radii.</p>
</div>


                            </div>
                            <div id="Skeleton.skeleton" class="classattr">
                                        <input id="Skeleton.skeleton-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">skeleton</span>

                <label class="view-source-button" for="Skeleton.skeleton-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Skeleton.skeleton"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Skeleton.skeleton-101"><a href="#Skeleton.skeleton-101"><span class="linenos">101</span></a>    <span class="nd">@property</span>
</span><span id="Skeleton.skeleton-102"><a href="#Skeleton.skeleton-102"><span class="linenos">102</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">skeleton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton.skeleton-103"><a href="#Skeleton.skeleton-103"><span class="linenos">103</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Skeleton as trimesh Path3D.&quot;&quot;&quot;</span>
</span><span id="Skeleton.skeleton-104"><a href="#Skeleton.skeleton-104"><span class="linenos">104</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_skeleton&quot;</span><span class="p">):</span>
</span><span id="Skeleton.skeleton-105"><a href="#Skeleton.skeleton-105"><span class="linenos">105</span></a>            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">tm</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">]</span>
</span><span id="Skeleton.skeleton-106"><a href="#Skeleton.skeleton-106"><span class="linenos">106</span></a>
</span><span id="Skeleton.skeleton-107"><a href="#Skeleton.skeleton-107"><span class="linenos">107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_skeleton</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">Path3D</span><span class="p">(</span>
</span><span id="Skeleton.skeleton-108"><a href="#Skeleton.skeleton-108"><span class="linenos">108</span></a>                <span class="n">entities</span><span class="o">=</span><span class="n">lines</span><span class="p">,</span> <span class="n">vertices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">process</span><span class="o">=</span><span class="kc">False</span>
</span><span id="Skeleton.skeleton-109"><a href="#Skeleton.skeleton-109"><span class="linenos">109</span></a>            <span class="p">)</span>
</span><span id="Skeleton.skeleton-110"><a href="#Skeleton.skeleton-110"><span class="linenos">110</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skeleton</span>
</span></pre></div>


            <div class="docstring"><p>Skeleton as trimesh Path3D.</p>
</div>


                            </div>
                            <div id="Skeleton.skel_map" class="classattr">
                                        <input id="Skeleton.skel_map-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">skel_map</span>

                <label class="view-source-button" for="Skeleton.skel_map-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Skeleton.skel_map"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Skeleton.skel_map-112"><a href="#Skeleton.skel_map-112"><span class="linenos">112</span></a>    <span class="nd">@property</span>
</span><span id="Skeleton.skel_map-113"><a href="#Skeleton.skel_map-113"><span class="linenos">113</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">skel_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton.skel_map-114"><a href="#Skeleton.skel_map-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Skeleton vertex (nodes) to mesh vertices. Based on `mesh_map`.&quot;&quot;&quot;</span>
</span><span id="Skeleton.skel_map-115"><a href="#Skeleton.skel_map-115"><span class="linenos">115</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_map</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
</span><span id="Skeleton.skel_map-116"><a href="#Skeleton.skel_map-116"><span class="linenos">116</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Skeleton.skel_map-117"><a href="#Skeleton.skel_map-117"><span class="linenos">117</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="Skeleton.skel_map-118"><a href="#Skeleton.skel_map-118"><span class="linenos">118</span></a>            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_map</span><span class="p">)</span>
</span><span id="Skeleton.skel_map-119"><a href="#Skeleton.skel_map-119"><span class="linenos">119</span></a>            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Skeleton.skel_map-120"><a href="#Skeleton.skel_map-120"><span class="linenos">120</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span>
</span><span id="Skeleton.skel_map-121"><a href="#Skeleton.skel_map-121"><span class="linenos">121</span></a>            <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
</span><span id="Skeleton.skel_map-122"><a href="#Skeleton.skel_map-122"><span class="linenos">122</span></a>            <span class="o">.</span><span class="n">values</span>
</span><span id="Skeleton.skel_map-123"><a href="#Skeleton.skel_map-123"><span class="linenos">123</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Skeleton vertex (nodes) to mesh vertices. Based on <code><a href="#Skeleton.mesh_map">mesh_map</a></code>.</p>
</div>


                            </div>
                            <div id="Skeleton.roots" class="classattr">
                                        <input id="Skeleton.roots-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">roots</span>

                <label class="view-source-button" for="Skeleton.roots-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Skeleton.roots"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Skeleton.roots-125"><a href="#Skeleton.roots-125"><span class="linenos">125</span></a>    <span class="nd">@property</span>
</span><span id="Skeleton.roots-126"><a href="#Skeleton.roots-126"><span class="linenos">126</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">roots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton.roots-127"><a href="#Skeleton.roots-127"><span class="linenos">127</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Root node(s).&quot;&quot;&quot;</span>
</span><span id="Skeleton.roots-128"><a href="#Skeleton.roots-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
</span></pre></div>


            <div class="docstring"><p>Root node(s).</p>
</div>


                            </div>
                            <div id="Skeleton.leafs" class="classattr">
                                        <input id="Skeleton.leafs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">leafs</span>

                <label class="view-source-button" for="Skeleton.leafs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Skeleton.leafs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Skeleton.leafs-130"><a href="#Skeleton.leafs-130"><span class="linenos">130</span></a>    <span class="nd">@property</span>
</span><span id="Skeleton.leafs-131"><a href="#Skeleton.leafs-131"><span class="linenos">131</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">leafs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton.leafs-132"><a href="#Skeleton.leafs-132"><span class="linenos">132</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Leaf nodes (includes root).&quot;&quot;&quot;</span>
</span><span id="Skeleton.leafs-133"><a href="#Skeleton.leafs-133"><span class="linenos">133</span></a>        <span class="n">swc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span>
</span><span id="Skeleton.leafs-134"><a href="#Skeleton.leafs-134"><span class="linenos">134</span></a>        <span class="n">leafs</span> <span class="o">=</span> <span class="n">swc</span><span class="p">[</span><span class="o">~</span><span class="n">swc</span><span class="o">.</span><span class="n">node_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">swc</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">swc</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)]</span>
</span><span id="Skeleton.leafs-135"><a href="#Skeleton.leafs-135"><span class="linenos">135</span></a>        <span class="k">return</span> <span class="n">leafs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Leaf nodes (includes root).</p>
</div>


                            </div>
                            <div id="Skeleton.reindex" class="classattr">
                                        <input id="Skeleton.reindex-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reindex</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Skeleton.reindex-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Skeleton.reindex"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Skeleton.reindex-137"><a href="#Skeleton.reindex-137"><span class="linenos">137</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reindex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Skeleton.reindex-138"><a href="#Skeleton.reindex-138"><span class="linenos">138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up skeleton.&quot;&quot;&quot;</span>
</span><span id="Skeleton.reindex-139"><a href="#Skeleton.reindex-139"><span class="linenos">139</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="Skeleton.reindex-140"><a href="#Skeleton.reindex-140"><span class="linenos">140</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
</span><span id="Skeleton.reindex-141"><a href="#Skeleton.reindex-141"><span class="linenos">141</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Skeleton.reindex-142"><a href="#Skeleton.reindex-142"><span class="linenos">142</span></a>
</span><span id="Skeleton.reindex-143"><a href="#Skeleton.reindex-143"><span class="linenos">143</span></a>        <span class="c1"># Re-index to make node IDs continous again</span>
</span><span id="Skeleton.reindex-144"><a href="#Skeleton.reindex-144"><span class="linenos">144</span></a>        <span class="n">x</span><span class="o">.</span><span class="n">swc</span><span class="p">,</span> <span class="n">new_ids</span> <span class="o">=</span> <span class="n">reindex_swc</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">swc</span><span class="p">)</span>
</span><span id="Skeleton.reindex-145"><a href="#Skeleton.reindex-145"><span class="linenos">145</span></a>
</span><span id="Skeleton.reindex-146"><a href="#Skeleton.reindex-146"><span class="linenos">146</span></a>        <span class="c1"># Update mesh map</span>
</span><span id="Skeleton.reindex-147"><a href="#Skeleton.reindex-147"><span class="linenos">147</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mesh_map</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
</span><span id="Skeleton.reindex-148"><a href="#Skeleton.reindex-148"><span class="linenos">148</span></a>            <span class="n">x</span><span class="o">.</span><span class="n">mesh_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">new_ids</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">mesh_map</span><span class="p">])</span>
</span><span id="Skeleton.reindex-149"><a href="#Skeleton.reindex-149"><span class="linenos">149</span></a>
</span><span id="Skeleton.reindex-150"><a href="#Skeleton.reindex-150"><span class="linenos">150</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">inplace</span><span class="p">:</span>
</span><span id="Skeleton.reindex-151"><a href="#Skeleton.reindex-151"><span class="linenos">151</span></a>            <span class="k">return</span> <span class="n">x</span>
</span></pre></div>


            <div class="docstring"><p>Clean up skeleton.</p>
</div>


                            </div>
                            <div id="Skeleton.reroot" class="classattr">
                                        <input id="Skeleton.reroot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reroot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">new_root</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Skeleton.reroot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Skeleton.reroot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Skeleton.reroot-153"><a href="#Skeleton.reroot-153"><span class="linenos">153</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reroot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_root</span><span class="p">):</span>
</span><span id="Skeleton.reroot-154"><a href="#Skeleton.reroot-154"><span class="linenos">154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reroot the skeleton.</span>
</span><span id="Skeleton.reroot-155"><a href="#Skeleton.reroot-155"><span class="linenos">155</span></a>
</span><span id="Skeleton.reroot-156"><a href="#Skeleton.reroot-156"><span class="linenos">156</span></a><span class="sd">        Parameters</span>
</span><span id="Skeleton.reroot-157"><a href="#Skeleton.reroot-157"><span class="linenos">157</span></a><span class="sd">        ----------</span>
</span><span id="Skeleton.reroot-158"><a href="#Skeleton.reroot-158"><span class="linenos">158</span></a><span class="sd">        new_root :  int</span>
</span><span id="Skeleton.reroot-159"><a href="#Skeleton.reroot-159"><span class="linenos">159</span></a><span class="sd">                    Index of node to use as new root. If the skeleton</span>
</span><span id="Skeleton.reroot-160"><a href="#Skeleton.reroot-160"><span class="linenos">160</span></a><span class="sd">                    consists of multiple trees, only the tree containing the</span>
</span><span id="Skeleton.reroot-161"><a href="#Skeleton.reroot-161"><span class="linenos">161</span></a><span class="sd">                    new root will be updated.</span>
</span><span id="Skeleton.reroot-162"><a href="#Skeleton.reroot-162"><span class="linenos">162</span></a>
</span><span id="Skeleton.reroot-163"><a href="#Skeleton.reroot-163"><span class="linenos">163</span></a><span class="sd">        Returns</span>
</span><span id="Skeleton.reroot-164"><a href="#Skeleton.reroot-164"><span class="linenos">164</span></a><span class="sd">        -------</span>
</span><span id="Skeleton.reroot-165"><a href="#Skeleton.reroot-165"><span class="linenos">165</span></a><span class="sd">        Skeleton</span>
</span><span id="Skeleton.reroot-166"><a href="#Skeleton.reroot-166"><span class="linenos">166</span></a><span class="sd">                    Skeleton with new root.</span>
</span><span id="Skeleton.reroot-167"><a href="#Skeleton.reroot-167"><span class="linenos">167</span></a>
</span><span id="Skeleton.reroot-168"><a href="#Skeleton.reroot-168"><span class="linenos">168</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Skeleton.reroot-169"><a href="#Skeleton.reroot-169"><span class="linenos">169</span></a>        <span class="k">assert</span> <span class="n">new_root</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Node index </span><span class="si">{</span><span class="n">new_root</span><span class="si">}</span><span class="s2"> not in skeleton.&quot;</span>
</span><span id="Skeleton.reroot-170"><a href="#Skeleton.reroot-170"><span class="linenos">170</span></a>
</span><span id="Skeleton.reroot-171"><a href="#Skeleton.reroot-171"><span class="linenos">171</span></a>        <span class="c1"># Make copy of self</span>
</span><span id="Skeleton.reroot-172"><a href="#Skeleton.reroot-172"><span class="linenos">172</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Skeleton.reroot-173"><a href="#Skeleton.reroot-173"><span class="linenos">173</span></a>
</span><span id="Skeleton.reroot-174"><a href="#Skeleton.reroot-174"><span class="linenos">174</span></a>        <span class="c1"># Check if the new root is already a root</span>
</span><span id="Skeleton.reroot-175"><a href="#Skeleton.reroot-175"><span class="linenos">175</span></a>        <span class="k">if</span> <span class="n">new_root</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">roots</span><span class="p">:</span>
</span><span id="Skeleton.reroot-176"><a href="#Skeleton.reroot-176"><span class="linenos">176</span></a>            <span class="k">return</span> <span class="n">x</span>
</span><span id="Skeleton.reroot-177"><a href="#Skeleton.reroot-177"><span class="linenos">177</span></a>
</span><span id="Skeleton.reroot-178"><a href="#Skeleton.reroot-178"><span class="linenos">178</span></a>        <span class="c1"># Get graph representation</span>
</span><span id="Skeleton.reroot-179"><a href="#Skeleton.reroot-179"><span class="linenos">179</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span>
</span><span id="Skeleton.reroot-180"><a href="#Skeleton.reroot-180"><span class="linenos">180</span></a>
</span><span id="Skeleton.reroot-181"><a href="#Skeleton.reroot-181"><span class="linenos">181</span></a>        <span class="c1"># Get the path from the new root to the current root (of the same tree)</span>
</span><span id="Skeleton.reroot-182"><a href="#Skeleton.reroot-182"><span class="linenos">182</span></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">roots</span><span class="p">:</span>
</span><span id="Skeleton.reroot-183"><a href="#Skeleton.reroot-183"><span class="linenos">183</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Skeleton.reroot-184"><a href="#Skeleton.reroot-184"><span class="linenos">184</span></a>                <span class="n">path</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">new_root</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>
</span><span id="Skeleton.reroot-185"><a href="#Skeleton.reroot-185"><span class="linenos">185</span></a>                <span class="k">break</span>
</span><span id="Skeleton.reroot-186"><a href="#Skeleton.reroot-186"><span class="linenos">186</span></a>            <span class="k">except</span> <span class="n">nx</span><span class="o">.</span><span class="n">NetworkXNoPath</span><span class="p">:</span>
</span><span id="Skeleton.reroot-187"><a href="#Skeleton.reroot-187"><span class="linenos">187</span></a>                <span class="k">continue</span>
</span><span id="Skeleton.reroot-188"><a href="#Skeleton.reroot-188"><span class="linenos">188</span></a>
</span><span id="Skeleton.reroot-189"><a href="#Skeleton.reroot-189"><span class="linenos">189</span></a>        <span class="c1"># Now we need to invert the path from the old root to the new root</span>
</span><span id="Skeleton.reroot-190"><a href="#Skeleton.reroot-190"><span class="linenos">190</span></a>        <span class="n">new_parents</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;node_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="Skeleton.reroot-191"><a href="#Skeleton.reroot-191"><span class="linenos">191</span></a>        <span class="n">new_parents</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">c</span><span class="p">:</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:])})</span>
</span><span id="Skeleton.reroot-192"><a href="#Skeleton.reroot-192"><span class="linenos">192</span></a>        <span class="n">new_parents</span><span class="p">[</span><span class="n">new_root</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Skeleton.reroot-193"><a href="#Skeleton.reroot-193"><span class="linenos">193</span></a>
</span><span id="Skeleton.reroot-194"><a href="#Skeleton.reroot-194"><span class="linenos">194</span></a>        <span class="c1"># Update the SWC table</span>
</span><span id="Skeleton.reroot-195"><a href="#Skeleton.reroot-195"><span class="linenos">195</span></a>        <span class="n">x</span><span class="o">.</span><span class="n">swc</span><span class="p">[</span><span class="s2">&quot;parent_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">node_id</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">new_parents</span><span class="p">)</span>
</span><span id="Skeleton.reroot-196"><a href="#Skeleton.reroot-196"><span class="linenos">196</span></a>
</span><span id="Skeleton.reroot-197"><a href="#Skeleton.reroot-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="n">x</span>
</span></pre></div>


            <div class="docstring"><p>Reroot the skeleton.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>new_root</strong> (int):
Index of node to use as new root. If the skeleton
consists of multiple trees, only the tree containing the
new root will be updated.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Skeleton</strong>: Skeleton with new root.</li>
</ul>
</div>


                            </div>
                            <div id="Skeleton.copy" class="classattr">
                                        <input id="Skeleton.copy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">copy</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Skeleton.copy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Skeleton.copy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Skeleton.copy-199"><a href="#Skeleton.copy-199"><span class="linenos">199</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton.copy-200"><a href="#Skeleton.copy-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return copy of the skeleton.&quot;&quot;&quot;</span>
</span><span id="Skeleton.copy-201"><a href="#Skeleton.copy-201"><span class="linenos">201</span></a>        <span class="k">return</span> <span class="n">Skeleton</span><span class="p">(</span>
</span><span id="Skeleton.copy-202"><a href="#Skeleton.copy-202"><span class="linenos">202</span></a>            <span class="n">swc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Skeleton.copy-203"><a href="#Skeleton.copy-203"><span class="linenos">203</span></a>            <span class="n">mesh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Skeleton.copy-204"><a href="#Skeleton.copy-204"><span class="linenos">204</span></a>            <span class="n">mesh_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_map</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Skeleton.copy-205"><a href="#Skeleton.copy-205"><span class="linenos">205</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_map</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
</span><span id="Skeleton.copy-206"><a href="#Skeleton.copy-206"><span class="linenos">206</span></a>            <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Skeleton.copy-207"><a href="#Skeleton.copy-207"><span class="linenos">207</span></a>            <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
</span><span id="Skeleton.copy-208"><a href="#Skeleton.copy-208"><span class="linenos">208</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return copy of the skeleton.</p>
</div>


                            </div>
                            <div id="Skeleton.get_graph" class="classattr">
                                        <input id="Skeleton.get_graph-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_graph</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Skeleton.get_graph-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Skeleton.get_graph"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Skeleton.get_graph-210"><a href="#Skeleton.get_graph-210"><span class="linenos">210</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Skeleton.get_graph-211"><a href="#Skeleton.get_graph-211"><span class="linenos">211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate networkX representation of the skeletons.</span>
</span><span id="Skeleton.get_graph-212"><a href="#Skeleton.get_graph-212"><span class="linenos">212</span></a>
</span><span id="Skeleton.get_graph-213"><a href="#Skeleton.get_graph-213"><span class="linenos">213</span></a><span class="sd">        Distance between nodes will be used as edge weights.</span>
</span><span id="Skeleton.get_graph-214"><a href="#Skeleton.get_graph-214"><span class="linenos">214</span></a>
</span><span id="Skeleton.get_graph-215"><a href="#Skeleton.get_graph-215"><span class="linenos">215</span></a><span class="sd">        Returns</span>
</span><span id="Skeleton.get_graph-216"><a href="#Skeleton.get_graph-216"><span class="linenos">216</span></a><span class="sd">        -------</span>
</span><span id="Skeleton.get_graph-217"><a href="#Skeleton.get_graph-217"><span class="linenos">217</span></a><span class="sd">        networkx.DiGraph</span>
</span><span id="Skeleton.get_graph-218"><a href="#Skeleton.get_graph-218"><span class="linenos">218</span></a>
</span><span id="Skeleton.get_graph-219"><a href="#Skeleton.get_graph-219"><span class="linenos">219</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Skeleton.get_graph-220"><a href="#Skeleton.get_graph-220"><span class="linenos">220</span></a>        <span class="n">not_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">&gt;=</span> <span class="mi">0</span>
</span><span id="Skeleton.get_graph-221"><a href="#Skeleton.get_graph-221"><span class="linenos">221</span></a>        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_root</span><span class="p">]</span>
</span><span id="Skeleton.get_graph-222"><a href="#Skeleton.get_graph-222"><span class="linenos">222</span></a>        <span class="n">parents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;node_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="Skeleton.get_graph-223"><a href="#Skeleton.get_graph-223"><span class="linenos">223</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">not_root</span><span class="p">,</span> <span class="s2">&quot;parent_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Skeleton.get_graph-224"><a href="#Skeleton.get_graph-224"><span class="linenos">224</span></a>        <span class="p">]</span>
</span><span id="Skeleton.get_graph-225"><a href="#Skeleton.get_graph-225"><span class="linenos">225</span></a>
</span><span id="Skeleton.get_graph-226"><a href="#Skeleton.get_graph-226"><span class="linenos">226</span></a>        <span class="n">dists</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">parents</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Skeleton.get_graph-227"><a href="#Skeleton.get_graph-227"><span class="linenos">227</span></a>        <span class="n">dists</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">dists</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Skeleton.get_graph-228"><a href="#Skeleton.get_graph-228"><span class="linenos">228</span></a>
</span><span id="Skeleton.get_graph-229"><a href="#Skeleton.get_graph-229"><span class="linenos">229</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
</span><span id="Skeleton.get_graph-230"><a href="#Skeleton.get_graph-230"><span class="linenos">230</span></a>        <span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">node_id</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</span><span id="Skeleton.get_graph-231"><a href="#Skeleton.get_graph-231"><span class="linenos">231</span></a>        <span class="n">G</span><span class="o">.</span><span class="n">add_weighted_edges_from</span><span class="p">(</span>
</span><span id="Skeleton.get_graph-232"><a href="#Skeleton.get_graph-232"><span class="linenos">232</span></a>            <span class="nb">zip</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">node_id</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dists</span><span class="p">)</span>
</span><span id="Skeleton.get_graph-233"><a href="#Skeleton.get_graph-233"><span class="linenos">233</span></a>        <span class="p">)</span>
</span><span id="Skeleton.get_graph-234"><a href="#Skeleton.get_graph-234"><span class="linenos">234</span></a>
</span><span id="Skeleton.get_graph-235"><a href="#Skeleton.get_graph-235"><span class="linenos">235</span></a>        <span class="k">return</span> <span class="n">G</span>
</span></pre></div>


            <div class="docstring"><p>Generate networkX representation of the skeletons.</p>

<p>Distance between nodes will be used as edge weights.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>networkx.DiGraph</strong></li>
</ul>
</div>


                            </div>
                            <div id="Skeleton.get_segments" class="classattr">
                                        <input id="Skeleton.get_segments-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_segments</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">weight</span><span class="o">=</span><span class="s1">&#39;weight&#39;</span>, </span><span class="param"><span class="n">return_lengths</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Skeleton.get_segments-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Skeleton.get_segments"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Skeleton.get_segments-237"><a href="#Skeleton.get_segments-237"><span class="linenos">237</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="n">return_lengths</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Skeleton.get_segments-238"><a href="#Skeleton.get_segments-238"><span class="linenos">238</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a list of linear segments while maximizing segment lengths.</span>
</span><span id="Skeleton.get_segments-239"><a href="#Skeleton.get_segments-239"><span class="linenos">239</span></a>
</span><span id="Skeleton.get_segments-240"><a href="#Skeleton.get_segments-240"><span class="linenos">240</span></a><span class="sd">        Parameters</span>
</span><span id="Skeleton.get_segments-241"><a href="#Skeleton.get_segments-241"><span class="linenos">241</span></a><span class="sd">        ----------</span>
</span><span id="Skeleton.get_segments-242"><a href="#Skeleton.get_segments-242"><span class="linenos">242</span></a><span class="sd">        weight :    &#39;weight&#39; | None, optional</span>
</span><span id="Skeleton.get_segments-243"><a href="#Skeleton.get_segments-243"><span class="linenos">243</span></a><span class="sd">                    If ``&quot;weight&quot;`` use physical, geodesic length to determine</span>
</span><span id="Skeleton.get_segments-244"><a href="#Skeleton.get_segments-244"><span class="linenos">244</span></a><span class="sd">                    segment length. If ``None`` use number of nodes (faster).</span>
</span><span id="Skeleton.get_segments-245"><a href="#Skeleton.get_segments-245"><span class="linenos">245</span></a><span class="sd">        return_lengths : bool</span>
</span><span id="Skeleton.get_segments-246"><a href="#Skeleton.get_segments-246"><span class="linenos">246</span></a><span class="sd">                    If True, also return lengths of segments according to ``weight``.</span>
</span><span id="Skeleton.get_segments-247"><a href="#Skeleton.get_segments-247"><span class="linenos">247</span></a>
</span><span id="Skeleton.get_segments-248"><a href="#Skeleton.get_segments-248"><span class="linenos">248</span></a><span class="sd">        Returns</span>
</span><span id="Skeleton.get_segments-249"><a href="#Skeleton.get_segments-249"><span class="linenos">249</span></a><span class="sd">        -------</span>
</span><span id="Skeleton.get_segments-250"><a href="#Skeleton.get_segments-250"><span class="linenos">250</span></a><span class="sd">        segments :  list</span>
</span><span id="Skeleton.get_segments-251"><a href="#Skeleton.get_segments-251"><span class="linenos">251</span></a><span class="sd">                    Segments as list of lists containing node IDs. List is</span>
</span><span id="Skeleton.get_segments-252"><a href="#Skeleton.get_segments-252"><span class="linenos">252</span></a><span class="sd">                    sorted by segment lengths.</span>
</span><span id="Skeleton.get_segments-253"><a href="#Skeleton.get_segments-253"><span class="linenos">253</span></a><span class="sd">        lengths :   list</span>
</span><span id="Skeleton.get_segments-254"><a href="#Skeleton.get_segments-254"><span class="linenos">254</span></a><span class="sd">                    Length for each segment according to ``weight``. Only provided</span>
</span><span id="Skeleton.get_segments-255"><a href="#Skeleton.get_segments-255"><span class="linenos">255</span></a><span class="sd">                    if `return_lengths` is True.</span>
</span><span id="Skeleton.get_segments-256"><a href="#Skeleton.get_segments-256"><span class="linenos">256</span></a>
</span><span id="Skeleton.get_segments-257"><a href="#Skeleton.get_segments-257"><span class="linenos">257</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Skeleton.get_segments-258"><a href="#Skeleton.get_segments-258"><span class="linenos">258</span></a>        <span class="k">assert</span> <span class="n">weight</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Unable to use weight &quot;</span><span class="si">{</span><span class="n">weight</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
</span><span id="Skeleton.get_segments-259"><a href="#Skeleton.get_segments-259"><span class="linenos">259</span></a>
</span><span id="Skeleton.get_segments-260"><a href="#Skeleton.get_segments-260"><span class="linenos">260</span></a>        <span class="c1"># Get graph representation</span>
</span><span id="Skeleton.get_segments-261"><a href="#Skeleton.get_segments-261"><span class="linenos">261</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span>
</span><span id="Skeleton.get_segments-262"><a href="#Skeleton.get_segments-262"><span class="linenos">262</span></a>
</span><span id="Skeleton.get_segments-263"><a href="#Skeleton.get_segments-263"><span class="linenos">263</span></a>        <span class="c1"># Get distances to root</span>
</span><span id="Skeleton.get_segments-264"><a href="#Skeleton.get_segments-264"><span class="linenos">264</span></a>        <span class="n">dists</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Skeleton.get_segments-265"><a href="#Skeleton.get_segments-265"><span class="linenos">265</span></a>        <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">node_id</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
</span><span id="Skeleton.get_segments-266"><a href="#Skeleton.get_segments-266"><span class="linenos">266</span></a>            <span class="n">dists</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">shortest_path_length</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">root</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">))</span>
</span><span id="Skeleton.get_segments-267"><a href="#Skeleton.get_segments-267"><span class="linenos">267</span></a>
</span><span id="Skeleton.get_segments-268"><a href="#Skeleton.get_segments-268"><span class="linenos">268</span></a>        <span class="c1"># Sort leaf nodes</span>
</span><span id="Skeleton.get_segments-269"><a href="#Skeleton.get_segments-269"><span class="linenos">269</span></a>        <span class="n">endNodeIDs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">leafs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">leafs</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">node_id</span><span class="o">.</span><span class="n">values</span>
</span><span id="Skeleton.get_segments-270"><a href="#Skeleton.get_segments-270"><span class="linenos">270</span></a>        <span class="n">endNodeIDs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">endNodeIDs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">dists</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Skeleton.get_segments-271"><a href="#Skeleton.get_segments-271"><span class="linenos">271</span></a>
</span><span id="Skeleton.get_segments-272"><a href="#Skeleton.get_segments-272"><span class="linenos">272</span></a>        <span class="n">seen</span><span class="p">:</span> <span class="nb">set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Skeleton.get_segments-273"><a href="#Skeleton.get_segments-273"><span class="linenos">273</span></a>        <span class="n">sequences</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Skeleton.get_segments-274"><a href="#Skeleton.get_segments-274"><span class="linenos">274</span></a>        <span class="k">for</span> <span class="n">nodeID</span> <span class="ow">in</span> <span class="n">endNodeIDs</span><span class="p">:</span>
</span><span id="Skeleton.get_segments-275"><a href="#Skeleton.get_segments-275"><span class="linenos">275</span></a>            <span class="n">sequence</span> <span class="o">=</span> <span class="p">[</span><span class="n">nodeID</span><span class="p">]</span>
</span><span id="Skeleton.get_segments-276"><a href="#Skeleton.get_segments-276"><span class="linenos">276</span></a>            <span class="n">parents</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">nodeID</span><span class="p">))</span>
</span><span id="Skeleton.get_segments-277"><a href="#Skeleton.get_segments-277"><span class="linenos">277</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Skeleton.get_segments-278"><a href="#Skeleton.get_segments-278"><span class="linenos">278</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">parents</span><span class="p">:</span>
</span><span id="Skeleton.get_segments-279"><a href="#Skeleton.get_segments-279"><span class="linenos">279</span></a>                    <span class="k">break</span>
</span><span id="Skeleton.get_segments-280"><a href="#Skeleton.get_segments-280"><span class="linenos">280</span></a>                <span class="n">parentID</span> <span class="o">=</span> <span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Skeleton.get_segments-281"><a href="#Skeleton.get_segments-281"><span class="linenos">281</span></a>                <span class="n">sequence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parentID</span><span class="p">)</span>
</span><span id="Skeleton.get_segments-282"><a href="#Skeleton.get_segments-282"><span class="linenos">282</span></a>                <span class="k">if</span> <span class="n">parentID</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
</span><span id="Skeleton.get_segments-283"><a href="#Skeleton.get_segments-283"><span class="linenos">283</span></a>                    <span class="k">break</span>
</span><span id="Skeleton.get_segments-284"><a href="#Skeleton.get_segments-284"><span class="linenos">284</span></a>                <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">parentID</span><span class="p">)</span>
</span><span id="Skeleton.get_segments-285"><a href="#Skeleton.get_segments-285"><span class="linenos">285</span></a>                <span class="n">parents</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">parentID</span><span class="p">))</span>
</span><span id="Skeleton.get_segments-286"><a href="#Skeleton.get_segments-286"><span class="linenos">286</span></a>
</span><span id="Skeleton.get_segments-287"><a href="#Skeleton.get_segments-287"><span class="linenos">287</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Skeleton.get_segments-288"><a href="#Skeleton.get_segments-288"><span class="linenos">288</span></a>                <span class="n">sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
</span><span id="Skeleton.get_segments-289"><a href="#Skeleton.get_segments-289"><span class="linenos">289</span></a>
</span><span id="Skeleton.get_segments-290"><a href="#Skeleton.get_segments-290"><span class="linenos">290</span></a>        <span class="c1"># Sort sequences by length</span>
</span><span id="Skeleton.get_segments-291"><a href="#Skeleton.get_segments-291"><span class="linenos">291</span></a>        <span class="n">lengths</span> <span class="o">=</span> <span class="p">[</span><span class="n">dists</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="n">dists</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">]</span>
</span><span id="Skeleton.get_segments-292"><a href="#Skeleton.get_segments-292"><span class="linenos">292</span></a>        <span class="n">sequences</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">lengths</span><span class="p">,</span> <span class="n">sequences</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
</span><span id="Skeleton.get_segments-293"><a href="#Skeleton.get_segments-293"><span class="linenos">293</span></a>
</span><span id="Skeleton.get_segments-294"><a href="#Skeleton.get_segments-294"><span class="linenos">294</span></a>        <span class="k">if</span> <span class="n">return_lengths</span><span class="p">:</span>
</span><span id="Skeleton.get_segments-295"><a href="#Skeleton.get_segments-295"><span class="linenos">295</span></a>            <span class="k">return</span> <span class="n">sequences</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lengths</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Skeleton.get_segments-296"><a href="#Skeleton.get_segments-296"><span class="linenos">296</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Skeleton.get_segments-297"><a href="#Skeleton.get_segments-297"><span class="linenos">297</span></a>            <span class="k">return</span> <span class="n">sequences</span>
</span></pre></div>


            <div class="docstring"><p>Generate a list of linear segments while maximizing segment lengths.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>weight</strong> ('weight' | None, optional):
If <code>"weight"</code> use physical, geodesic length to determine
segment length. If <code>None</code> use number of nodes (faster).</li>
<li><strong>return_lengths</strong> (bool):
If True, also return lengths of segments according to <code>weight</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>segments</strong> (list):
Segments as list of lists containing node IDs. List is
sorted by segment lengths.</li>
<li><strong>lengths</strong> (list):
Length for each segment according to <code>weight</code>. Only provided
if <code>return_lengths</code> is True.</li>
</ul>
</div>


                            </div>
                            <div id="Skeleton.save_swc" class="classattr">
                                        <input id="Skeleton.save_swc-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_swc</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">filepath</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Skeleton.save_swc-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Skeleton.save_swc"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Skeleton.save_swc-299"><a href="#Skeleton.save_swc-299"><span class="linenos">299</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_swc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
</span><span id="Skeleton.save_swc-300"><a href="#Skeleton.save_swc-300"><span class="linenos">300</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save skeleton in SWC format.</span>
</span><span id="Skeleton.save_swc-301"><a href="#Skeleton.save_swc-301"><span class="linenos">301</span></a>
</span><span id="Skeleton.save_swc-302"><a href="#Skeleton.save_swc-302"><span class="linenos">302</span></a><span class="sd">        Parameters</span>
</span><span id="Skeleton.save_swc-303"><a href="#Skeleton.save_swc-303"><span class="linenos">303</span></a><span class="sd">        ----------</span>
</span><span id="Skeleton.save_swc-304"><a href="#Skeleton.save_swc-304"><span class="linenos">304</span></a><span class="sd">        filepath :      path-like</span>
</span><span id="Skeleton.save_swc-305"><a href="#Skeleton.save_swc-305"><span class="linenos">305</span></a><span class="sd">                        Filepath to save SWC to.</span>
</span><span id="Skeleton.save_swc-306"><a href="#Skeleton.save_swc-306"><span class="linenos">306</span></a>
</span><span id="Skeleton.save_swc-307"><a href="#Skeleton.save_swc-307"><span class="linenos">307</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Skeleton.save_swc-308"><a href="#Skeleton.save_swc-308"><span class="linenos">308</span></a>        <span class="n">header</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
</span><span id="Skeleton.save_swc-309"><a href="#Skeleton.save_swc-309"><span class="linenos">309</span></a><span class="s2">        # SWC format file</span>
</span><span id="Skeleton.save_swc-310"><a href="#Skeleton.save_swc-310"><span class="linenos">310</span></a><span class="s2">        # based on specifications at http://www.neuronland.org/NLMorphologyConverter/MorphologyFormats/SWC/Spec.html</span>
</span><span id="Skeleton.save_swc-311"><a href="#Skeleton.save_swc-311"><span class="linenos">311</span></a><span class="s2">        # Created on </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="si">}</span><span class="s2"> using skeletor (https://github.com/navis-org/skeletor)</span>
</span><span id="Skeleton.save_swc-312"><a href="#Skeleton.save_swc-312"><span class="linenos">312</span></a><span class="s2">        # PointNo Label X Y Z Radius Parent</span>
</span><span id="Skeleton.save_swc-313"><a href="#Skeleton.save_swc-313"><span class="linenos">313</span></a><span class="s2">        # Labels:</span>
</span><span id="Skeleton.save_swc-314"><a href="#Skeleton.save_swc-314"><span class="linenos">314</span></a><span class="s2">        # 0 = undefined, 1 = soma, 5 = fork point, 6 = end point</span>
</span><span id="Skeleton.save_swc-315"><a href="#Skeleton.save_swc-315"><span class="linenos">315</span></a><span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="Skeleton.save_swc-316"><a href="#Skeleton.save_swc-316"><span class="linenos">316</span></a>
</span><span id="Skeleton.save_swc-317"><a href="#Skeleton.save_swc-317"><span class="linenos">317</span></a>        <span class="c1"># Make copy of SWC table</span>
</span><span id="Skeleton.save_swc-318"><a href="#Skeleton.save_swc-318"><span class="linenos">318</span></a>        <span class="n">swc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Skeleton.save_swc-319"><a href="#Skeleton.save_swc-319"><span class="linenos">319</span></a>
</span><span id="Skeleton.save_swc-320"><a href="#Skeleton.save_swc-320"><span class="linenos">320</span></a>        <span class="c1"># Set all labels to undefined</span>
</span><span id="Skeleton.save_swc-321"><a href="#Skeleton.save_swc-321"><span class="linenos">321</span></a>        <span class="n">swc</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Skeleton.save_swc-322"><a href="#Skeleton.save_swc-322"><span class="linenos">322</span></a>        <span class="n">swc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">swc</span><span class="o">.</span><span class="n">node_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">swc</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
</span><span id="Skeleton.save_swc-323"><a href="#Skeleton.save_swc-323"><span class="linenos">323</span></a>        <span class="n">n_childs</span> <span class="o">=</span> <span class="n">swc</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;parent_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="Skeleton.save_swc-324"><a href="#Skeleton.save_swc-324"><span class="linenos">324</span></a>        <span class="n">bp</span> <span class="o">=</span> <span class="n">n_childs</span><span class="p">[</span><span class="n">n_childs</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
</span><span id="Skeleton.save_swc-325"><a href="#Skeleton.save_swc-325"><span class="linenos">325</span></a>        <span class="n">swc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">swc</span><span class="o">.</span><span class="n">node_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">bp</span><span class="p">),</span> <span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Skeleton.save_swc-326"><a href="#Skeleton.save_swc-326"><span class="linenos">326</span></a>
</span><span id="Skeleton.save_swc-327"><a href="#Skeleton.save_swc-327"><span class="linenos">327</span></a>        <span class="c1"># Add radius if missing</span>
</span><span id="Skeleton.save_swc-328"><a href="#Skeleton.save_swc-328"><span class="linenos">328</span></a>        <span class="k">if</span> <span class="s2">&quot;radius&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">swc</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="Skeleton.save_swc-329"><a href="#Skeleton.save_swc-329"><span class="linenos">329</span></a>            <span class="n">swc</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Skeleton.save_swc-330"><a href="#Skeleton.save_swc-330"><span class="linenos">330</span></a>
</span><span id="Skeleton.save_swc-331"><a href="#Skeleton.save_swc-331"><span class="linenos">331</span></a>        <span class="c1"># Get things in order</span>
</span><span id="Skeleton.save_swc-332"><a href="#Skeleton.save_swc-332"><span class="linenos">332</span></a>        <span class="n">swc</span> <span class="o">=</span> <span class="n">swc</span><span class="p">[[</span><span class="s2">&quot;node_id&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="s2">&quot;parent_id&quot;</span><span class="p">]]</span>
</span><span id="Skeleton.save_swc-333"><a href="#Skeleton.save_swc-333"><span class="linenos">333</span></a>
</span><span id="Skeleton.save_swc-334"><a href="#Skeleton.save_swc-334"><span class="linenos">334</span></a>        <span class="c1"># Adjust column titles</span>
</span><span id="Skeleton.save_swc-335"><a href="#Skeleton.save_swc-335"><span class="linenos">335</span></a>        <span class="n">swc</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;PointNo&quot;</span><span class="p">,</span> <span class="s2">&quot;Label&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;Radius&quot;</span><span class="p">,</span> <span class="s2">&quot;Parent&quot;</span><span class="p">]</span>
</span><span id="Skeleton.save_swc-336"><a href="#Skeleton.save_swc-336"><span class="linenos">336</span></a>
</span><span id="Skeleton.save_swc-337"><a href="#Skeleton.save_swc-337"><span class="linenos">337</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="Skeleton.save_swc-338"><a href="#Skeleton.save_swc-338"><span class="linenos">338</span></a>            <span class="c1"># Write header</span>
</span><span id="Skeleton.save_swc-339"><a href="#Skeleton.save_swc-339"><span class="linenos">339</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
</span><span id="Skeleton.save_swc-340"><a href="#Skeleton.save_swc-340"><span class="linenos">340</span></a>
</span><span id="Skeleton.save_swc-341"><a href="#Skeleton.save_swc-341"><span class="linenos">341</span></a>            <span class="c1"># Write data</span>
</span><span id="Skeleton.save_swc-342"><a href="#Skeleton.save_swc-342"><span class="linenos">342</span></a>            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="Skeleton.save_swc-343"><a href="#Skeleton.save_swc-343"><span class="linenos">343</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">swc</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Save skeleton in SWC format.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>filepath</strong> (path-like):
Filepath to save SWC to.</li>
</ul>
</div>


                            </div>
                            <div id="Skeleton.scene" class="classattr">
                                        <input id="Skeleton.scene-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">scene</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">mesh</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Skeleton.scene-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Skeleton.scene"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Skeleton.scene-345"><a href="#Skeleton.scene-345"><span class="linenos">345</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scene</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Skeleton.scene-346"><a href="#Skeleton.scene-346"><span class="linenos">346</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a Scene object containing the skeleton.</span>
</span><span id="Skeleton.scene-347"><a href="#Skeleton.scene-347"><span class="linenos">347</span></a>
</span><span id="Skeleton.scene-348"><a href="#Skeleton.scene-348"><span class="linenos">348</span></a><span class="sd">        Returns</span>
</span><span id="Skeleton.scene-349"><a href="#Skeleton.scene-349"><span class="linenos">349</span></a><span class="sd">        -------</span>
</span><span id="Skeleton.scene-350"><a href="#Skeleton.scene-350"><span class="linenos">350</span></a><span class="sd">        scene :     trimesh.scene.scene.Scene</span>
</span><span id="Skeleton.scene-351"><a href="#Skeleton.scene-351"><span class="linenos">351</span></a><span class="sd">                    Contains the skeleton and optionally the mesh.</span>
</span><span id="Skeleton.scene-352"><a href="#Skeleton.scene-352"><span class="linenos">352</span></a>
</span><span id="Skeleton.scene-353"><a href="#Skeleton.scene-353"><span class="linenos">353</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Skeleton.scene-354"><a href="#Skeleton.scene-354"><span class="linenos">354</span></a>        <span class="k">if</span> <span class="n">mesh</span><span class="p">:</span>
</span><span id="Skeleton.scene-355"><a href="#Skeleton.scene-355"><span class="linenos">355</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
</span><span id="Skeleton.scene-356"><a href="#Skeleton.scene-356"><span class="linenos">356</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Skeleton has no mesh.&quot;</span><span class="p">)</span>
</span><span id="Skeleton.scene-357"><a href="#Skeleton.scene-357"><span class="linenos">357</span></a>
</span><span id="Skeleton.scene-358"><a href="#Skeleton.scene-358"><span class="linenos">358</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">visual</span><span class="o">.</span><span class="n">face_colors</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
</span><span id="Skeleton.scene-359"><a href="#Skeleton.scene-359"><span class="linenos">359</span></a>
</span><span id="Skeleton.scene-360"><a href="#Skeleton.scene-360"><span class="linenos">360</span></a>            <span class="c1"># Note the copy(): without it the transform in show() changes</span>
</span><span id="Skeleton.scene-361"><a href="#Skeleton.scene-361"><span class="linenos">361</span></a>            <span class="c1"># the original meshes</span>
</span><span id="Skeleton.scene-362"><a href="#Skeleton.scene-362"><span class="linenos">362</span></a>            <span class="n">sc</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">Scene</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">skeleton</span><span class="o">.</span><span class="n">copy</span><span class="p">()],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Skeleton.scene-363"><a href="#Skeleton.scene-363"><span class="linenos">363</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Skeleton.scene-364"><a href="#Skeleton.scene-364"><span class="linenos">364</span></a>            <span class="n">sc</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skeleton</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Skeleton.scene-365"><a href="#Skeleton.scene-365"><span class="linenos">365</span></a>
</span><span id="Skeleton.scene-366"><a href="#Skeleton.scene-366"><span class="linenos">366</span></a>        <span class="k">return</span> <span class="n">sc</span>
</span></pre></div>


            <div class="docstring"><p>Return a Scene object containing the skeleton.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>scene</strong> (trimesh.scene.scene.Scene):
Contains the skeleton and optionally the mesh.</li>
</ul>
</div>


                            </div>
                            <div id="Skeleton.show" class="classattr">
                                        <input id="Skeleton.show-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">show</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">mesh</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Skeleton.show-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Skeleton.show"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Skeleton.show-368"><a href="#Skeleton.show-368"><span class="linenos">368</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Skeleton.show-369"><a href="#Skeleton.show-369"><span class="linenos">369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Render the skeleton in an opengl window. Requires pyglet.</span>
</span><span id="Skeleton.show-370"><a href="#Skeleton.show-370"><span class="linenos">370</span></a>
</span><span id="Skeleton.show-371"><a href="#Skeleton.show-371"><span class="linenos">371</span></a><span class="sd">        Parameters</span>
</span><span id="Skeleton.show-372"><a href="#Skeleton.show-372"><span class="linenos">372</span></a><span class="sd">        ----------</span>
</span><span id="Skeleton.show-373"><a href="#Skeleton.show-373"><span class="linenos">373</span></a><span class="sd">        mesh :      bool</span>
</span><span id="Skeleton.show-374"><a href="#Skeleton.show-374"><span class="linenos">374</span></a><span class="sd">                    If True, will render transparent mesh on top of the</span>
</span><span id="Skeleton.show-375"><a href="#Skeleton.show-375"><span class="linenos">375</span></a><span class="sd">                    skeleton.</span>
</span><span id="Skeleton.show-376"><a href="#Skeleton.show-376"><span class="linenos">376</span></a>
</span><span id="Skeleton.show-377"><a href="#Skeleton.show-377"><span class="linenos">377</span></a><span class="sd">        Returns</span>
</span><span id="Skeleton.show-378"><a href="#Skeleton.show-378"><span class="linenos">378</span></a><span class="sd">        --------</span>
</span><span id="Skeleton.show-379"><a href="#Skeleton.show-379"><span class="linenos">379</span></a><span class="sd">        scene :     trimesh.scene.Scene</span>
</span><span id="Skeleton.show-380"><a href="#Skeleton.show-380"><span class="linenos">380</span></a><span class="sd">                    Scene with skeleton in it.</span>
</span><span id="Skeleton.show-381"><a href="#Skeleton.show-381"><span class="linenos">381</span></a>
</span><span id="Skeleton.show-382"><a href="#Skeleton.show-382"><span class="linenos">382</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Skeleton.show-383"><a href="#Skeleton.show-383"><span class="linenos">383</span></a>        <span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">)</span>
</span><span id="Skeleton.show-384"><a href="#Skeleton.show-384"><span class="linenos">384</span></a>
</span><span id="Skeleton.show-385"><a href="#Skeleton.show-385"><span class="linenos">385</span></a>        <span class="c1"># I encountered some issues if object space is big and the easiest</span>
</span><span id="Skeleton.show-386"><a href="#Skeleton.show-386"><span class="linenos">386</span></a>        <span class="c1"># way to work around this is to apply a transform such that the</span>
</span><span id="Skeleton.show-387"><a href="#Skeleton.show-387"><span class="linenos">387</span></a>        <span class="c1"># coordinates have -5 to +5 bounds</span>
</span><span id="Skeleton.show-388"><a href="#Skeleton.show-388"><span class="linenos">388</span></a>        <span class="n">fac</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skeleton</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Skeleton.show-389"><a href="#Skeleton.show-389"><span class="linenos">389</span></a>        <span class="n">scene</span><span class="o">.</span><span class="n">apply_transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="n">fac</span><span class="p">,</span> <span class="n">fac</span><span class="p">,</span> <span class="n">fac</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="Skeleton.show-390"><a href="#Skeleton.show-390"><span class="linenos">390</span></a>
</span><span id="Skeleton.show-391"><a href="#Skeleton.show-391"><span class="linenos">391</span></a>        <span class="k">return</span> <span class="n">scene</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Render the skeleton in an opengl window. Requires pyglet.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>mesh</strong> (bool):
If True, will render transparent mesh on top of the
skeleton.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>scene</strong> (trimesh.scene.Scene):
Scene with skeleton in it.</li>
</ul>
</div>


                            </div>
                            <div id="Skeleton.mend_breaks" class="classattr">
                                        <input id="Skeleton.mend_breaks-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mend_breaks</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">dist_mult</span><span class="o">=</span><span class="mi">5</span>, </span><span class="param"><span class="n">dist_min</span><span class="o">=</span><span class="mi">0</span>, </span><span class="param"><span class="n">dist_max</span><span class="o">=</span><span class="n">inf</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Skeleton.mend_breaks-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Skeleton.mend_breaks"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Skeleton.mend_breaks-393"><a href="#Skeleton.mend_breaks-393"><span class="linenos">393</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mend_breaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist_mult</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">dist_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dist_max</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">):</span>
</span><span id="Skeleton.mend_breaks-394"><a href="#Skeleton.mend_breaks-394"><span class="linenos">394</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Mend breaks in the skeleton using the original mesh.</span>
</span><span id="Skeleton.mend_breaks-395"><a href="#Skeleton.mend_breaks-395"><span class="linenos">395</span></a>
</span><span id="Skeleton.mend_breaks-396"><a href="#Skeleton.mend_breaks-396"><span class="linenos">396</span></a><span class="sd">        This works by comparing the connectivity of the original mesh with that</span>
</span><span id="Skeleton.mend_breaks-397"><a href="#Skeleton.mend_breaks-397"><span class="linenos">397</span></a><span class="sd">        of the skeleton. If the shortest path between two adjacent vertices on the mesh</span>
</span><span id="Skeleton.mend_breaks-398"><a href="#Skeleton.mend_breaks-398"><span class="linenos">398</span></a><span class="sd">        is shorter than the distance between the nodes in the skeleton, a new edge</span>
</span><span id="Skeleton.mend_breaks-399"><a href="#Skeleton.mend_breaks-399"><span class="linenos">399</span></a><span class="sd">        is added to the skeleton.</span>
</span><span id="Skeleton.mend_breaks-400"><a href="#Skeleton.mend_breaks-400"><span class="linenos">400</span></a>
</span><span id="Skeleton.mend_breaks-401"><a href="#Skeleton.mend_breaks-401"><span class="linenos">401</span></a><span class="sd">        Parameters</span>
</span><span id="Skeleton.mend_breaks-402"><a href="#Skeleton.mend_breaks-402"><span class="linenos">402</span></a><span class="sd">        ----------</span>
</span><span id="Skeleton.mend_breaks-403"><a href="#Skeleton.mend_breaks-403"><span class="linenos">403</span></a><span class="sd">        dist_mult : float, optional</span>
</span><span id="Skeleton.mend_breaks-404"><a href="#Skeleton.mend_breaks-404"><span class="linenos">404</span></a><span class="sd">                    Factor by which the new edge should be shorter than the</span>
</span><span id="Skeleton.mend_breaks-405"><a href="#Skeleton.mend_breaks-405"><span class="linenos">405</span></a><span class="sd">                    current shortest path between two nodes to be added.</span>
</span><span id="Skeleton.mend_breaks-406"><a href="#Skeleton.mend_breaks-406"><span class="linenos">406</span></a><span class="sd">                    Lower values = fewer false negatives; higher values = fewer</span>
</span><span id="Skeleton.mend_breaks-407"><a href="#Skeleton.mend_breaks-407"><span class="linenos">407</span></a><span class="sd">                    false positive edges.</span>
</span><span id="Skeleton.mend_breaks-408"><a href="#Skeleton.mend_breaks-408"><span class="linenos">408</span></a><span class="sd">        dist_min :  float, optional</span>
</span><span id="Skeleton.mend_breaks-409"><a href="#Skeleton.mend_breaks-409"><span class="linenos">409</span></a><span class="sd">                    Minimum distance between nodes to consider adding an edge.</span>
</span><span id="Skeleton.mend_breaks-410"><a href="#Skeleton.mend_breaks-410"><span class="linenos">410</span></a><span class="sd">                    Use this to avoid adding very short edges.</span>
</span><span id="Skeleton.mend_breaks-411"><a href="#Skeleton.mend_breaks-411"><span class="linenos">411</span></a><span class="sd">        dist_max :  float, optional</span>
</span><span id="Skeleton.mend_breaks-412"><a href="#Skeleton.mend_breaks-412"><span class="linenos">412</span></a><span class="sd">                    Maximum distance between nodes to consider adding an edge.</span>
</span><span id="Skeleton.mend_breaks-413"><a href="#Skeleton.mend_breaks-413"><span class="linenos">413</span></a><span class="sd">                    Use this to avoid adding very long edges.</span>
</span><span id="Skeleton.mend_breaks-414"><a href="#Skeleton.mend_breaks-414"><span class="linenos">414</span></a>
</span><span id="Skeleton.mend_breaks-415"><a href="#Skeleton.mend_breaks-415"><span class="linenos">415</span></a><span class="sd">        Returns</span>
</span><span id="Skeleton.mend_breaks-416"><a href="#Skeleton.mend_breaks-416"><span class="linenos">416</span></a><span class="sd">        -------</span>
</span><span id="Skeleton.mend_breaks-417"><a href="#Skeleton.mend_breaks-417"><span class="linenos">417</span></a><span class="sd">        edges :     (N, 2) array</span>
</span><span id="Skeleton.mend_breaks-418"><a href="#Skeleton.mend_breaks-418"><span class="linenos">418</span></a><span class="sd">                    Edges connecting the skeleton nodes.</span>
</span><span id="Skeleton.mend_breaks-419"><a href="#Skeleton.mend_breaks-419"><span class="linenos">419</span></a><span class="sd">        vertices :  (N, 3) array</span>
</span><span id="Skeleton.mend_breaks-420"><a href="#Skeleton.mend_breaks-420"><span class="linenos">420</span></a><span class="sd">                    Positions of the skeleton nodes.</span>
</span><span id="Skeleton.mend_breaks-421"><a href="#Skeleton.mend_breaks-421"><span class="linenos">421</span></a>
</span><span id="Skeleton.mend_breaks-422"><a href="#Skeleton.mend_breaks-422"><span class="linenos">422</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Skeleton.mend_breaks-423"><a href="#Skeleton.mend_breaks-423"><span class="linenos">423</span></a>        <span class="c1"># We need `.mesh_map` and `.mesh` to exist</span>
</span><span id="Skeleton.mend_breaks-424"><a href="#Skeleton.mend_breaks-424"><span class="linenos">424</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Skeleton.mend_breaks-425"><a href="#Skeleton.mend_breaks-425"><span class="linenos">425</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Skeleton must have a `mesh_map` to mend breaks.&quot;</span><span class="p">)</span>
</span><span id="Skeleton.mend_breaks-426"><a href="#Skeleton.mend_breaks-426"><span class="linenos">426</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Skeleton.mend_breaks-427"><a href="#Skeleton.mend_breaks-427"><span class="linenos">427</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Skeleton must have a `mesh` to mend breaks.&quot;</span><span class="p">)</span>
</span><span id="Skeleton.mend_breaks-428"><a href="#Skeleton.mend_breaks-428"><span class="linenos">428</span></a>
</span><span id="Skeleton.mend_breaks-429"><a href="#Skeleton.mend_breaks-429"><span class="linenos">429</span></a>        <span class="c1"># Make a copy of the mesh edges</span>
</span><span id="Skeleton.mend_breaks-430"><a href="#Skeleton.mend_breaks-430"><span class="linenos">430</span></a>        <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Skeleton.mend_breaks-431"><a href="#Skeleton.mend_breaks-431"><span class="linenos">431</span></a>        <span class="c1"># Map mesh vertices to skeleton vertices</span>
</span><span id="Skeleton.mend_breaks-432"><a href="#Skeleton.mend_breaks-432"><span class="linenos">432</span></a>        <span class="n">edges</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]]</span>
</span><span id="Skeleton.mend_breaks-433"><a href="#Skeleton.mend_breaks-433"><span class="linenos">433</span></a>        <span class="n">edges</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">edges</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
</span><span id="Skeleton.mend_breaks-434"><a href="#Skeleton.mend_breaks-434"><span class="linenos">434</span></a>        <span class="c1"># Deduplicate</span>
</span><span id="Skeleton.mend_breaks-435"><a href="#Skeleton.mend_breaks-435"><span class="linenos">435</span></a>        <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Skeleton.mend_breaks-436"><a href="#Skeleton.mend_breaks-436"><span class="linenos">436</span></a>        <span class="c1"># Remove self edges</span>
</span><span id="Skeleton.mend_breaks-437"><a href="#Skeleton.mend_breaks-437"><span class="linenos">437</span></a>        <span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="n">edges</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">edges</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
</span><span id="Skeleton.mend_breaks-438"><a href="#Skeleton.mend_breaks-438"><span class="linenos">438</span></a>
</span><span id="Skeleton.mend_breaks-439"><a href="#Skeleton.mend_breaks-439"><span class="linenos">439</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">to_undirected</span><span class="p">()</span>
</span><span id="Skeleton.mend_breaks-440"><a href="#Skeleton.mend_breaks-440"><span class="linenos">440</span></a>
</span><span id="Skeleton.mend_breaks-441"><a href="#Skeleton.mend_breaks-441"><span class="linenos">441</span></a>        <span class="c1"># Remove edges that are already in the skeleton</span>
</span><span id="Skeleton.mend_breaks-442"><a href="#Skeleton.mend_breaks-442"><span class="linenos">442</span></a>        <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edges</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">G</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">)])</span>
</span><span id="Skeleton.mend_breaks-443"><a href="#Skeleton.mend_breaks-443"><span class="linenos">443</span></a>
</span><span id="Skeleton.mend_breaks-444"><a href="#Skeleton.mend_breaks-444"><span class="linenos">444</span></a>        <span class="c1"># Calculate distance between these new edge candidates</span>
</span><span id="Skeleton.mend_breaks-445"><a href="#Skeleton.mend_breaks-445"><span class="linenos">445</span></a>        <span class="n">dists</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
</span><span id="Skeleton.mend_breaks-446"><a href="#Skeleton.mend_breaks-446"><span class="linenos">446</span></a>            <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">edges</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">edges</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Skeleton.mend_breaks-447"><a href="#Skeleton.mend_breaks-447"><span class="linenos">447</span></a>        <span class="p">)</span>
</span><span id="Skeleton.mend_breaks-448"><a href="#Skeleton.mend_breaks-448"><span class="linenos">448</span></a>
</span><span id="Skeleton.mend_breaks-449"><a href="#Skeleton.mend_breaks-449"><span class="linenos">449</span></a>        <span class="c1"># Sort by distance (lowest first)</span>
</span><span id="Skeleton.mend_breaks-450"><a href="#Skeleton.mend_breaks-450"><span class="linenos">450</span></a>        <span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">dists</span><span class="p">)]</span>
</span><span id="Skeleton.mend_breaks-451"><a href="#Skeleton.mend_breaks-451"><span class="linenos">451</span></a>        <span class="n">dists</span> <span class="o">=</span> <span class="n">dists</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">dists</span><span class="p">)]</span>
</span><span id="Skeleton.mend_breaks-452"><a href="#Skeleton.mend_breaks-452"><span class="linenos">452</span></a>
</span><span id="Skeleton.mend_breaks-453"><a href="#Skeleton.mend_breaks-453"><span class="linenos">453</span></a>        <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">dists</span><span class="p">):</span>
</span><span id="Skeleton.mend_breaks-454"><a href="#Skeleton.mend_breaks-454"><span class="linenos">454</span></a>            <span class="c1"># Check if the new path would be shorter than the current shortest path</span>
</span><span id="Skeleton.mend_breaks-455"><a href="#Skeleton.mend_breaks-455"><span class="linenos">455</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">dist_mult</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path_length</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Skeleton.mend_breaks-456"><a href="#Skeleton.mend_breaks-456"><span class="linenos">456</span></a>                <span class="k">continue</span>
</span><span id="Skeleton.mend_breaks-457"><a href="#Skeleton.mend_breaks-457"><span class="linenos">457</span></a>            <span class="c1"># Check if the distance is within bounds</span>
</span><span id="Skeleton.mend_breaks-458"><a href="#Skeleton.mend_breaks-458"><span class="linenos">458</span></a>            <span class="k">elif</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">dist_min</span><span class="p">:</span>
</span><span id="Skeleton.mend_breaks-459"><a href="#Skeleton.mend_breaks-459"><span class="linenos">459</span></a>                <span class="k">continue</span>
</span><span id="Skeleton.mend_breaks-460"><a href="#Skeleton.mend_breaks-460"><span class="linenos">460</span></a>            <span class="k">elif</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="n">dist_max</span><span class="p">:</span>
</span><span id="Skeleton.mend_breaks-461"><a href="#Skeleton.mend_breaks-461"><span class="linenos">461</span></a>                <span class="k">continue</span>
</span><span id="Skeleton.mend_breaks-462"><a href="#Skeleton.mend_breaks-462"><span class="linenos">462</span></a>            <span class="c1"># Add edge</span>
</span><span id="Skeleton.mend_breaks-463"><a href="#Skeleton.mend_breaks-463"><span class="linenos">463</span></a>            <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
</span><span id="Skeleton.mend_breaks-464"><a href="#Skeleton.mend_breaks-464"><span class="linenos">464</span></a>
</span><span id="Skeleton.mend_breaks-465"><a href="#Skeleton.mend_breaks-465"><span class="linenos">465</span></a>        <span class="c1"># The above may have introduced small triangles which we should try to remove</span>
</span><span id="Skeleton.mend_breaks-466"><a href="#Skeleton.mend_breaks-466"><span class="linenos">466</span></a>        <span class="c1"># by removing the longest edge in a triangle. I have also spotted more</span>
</span><span id="Skeleton.mend_breaks-467"><a href="#Skeleton.mend_breaks-467"><span class="linenos">467</span></a>        <span class="c1"># complex cases of four or more nodes forming false-positive loops but</span>
</span><span id="Skeleton.mend_breaks-468"><a href="#Skeleton.mend_breaks-468"><span class="linenos">468</span></a>        <span class="c1"># these will be harder to detect and remove.</span>
</span><span id="Skeleton.mend_breaks-469"><a href="#Skeleton.mend_breaks-469"><span class="linenos">469</span></a>
</span><span id="Skeleton.mend_breaks-470"><a href="#Skeleton.mend_breaks-470"><span class="linenos">470</span></a>        <span class="c1"># First collect neighbors for each node</span>
</span><span id="Skeleton.mend_breaks-471"><a href="#Skeleton.mend_breaks-471"><span class="linenos">471</span></a>        <span class="n">later_nbrs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Skeleton.mend_breaks-472"><a href="#Skeleton.mend_breaks-472"><span class="linenos">472</span></a>        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">neighbors</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">adjacency</span><span class="p">():</span>
</span><span id="Skeleton.mend_breaks-473"><a href="#Skeleton.mend_breaks-473"><span class="linenos">473</span></a>            <span class="n">later_nbrs</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Skeleton.mend_breaks-474"><a href="#Skeleton.mend_breaks-474"><span class="linenos">474</span></a>                <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">neighbors</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">later_nbrs</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">node</span>
</span><span id="Skeleton.mend_breaks-475"><a href="#Skeleton.mend_breaks-475"><span class="linenos">475</span></a>            <span class="p">}</span>
</span><span id="Skeleton.mend_breaks-476"><a href="#Skeleton.mend_breaks-476"><span class="linenos">476</span></a>
</span><span id="Skeleton.mend_breaks-477"><a href="#Skeleton.mend_breaks-477"><span class="linenos">477</span></a>        <span class="c1"># Go over each node</span>
</span><span id="Skeleton.mend_breaks-478"><a href="#Skeleton.mend_breaks-478"><span class="linenos">478</span></a>        <span class="n">triangles</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Skeleton.mend_breaks-479"><a href="#Skeleton.mend_breaks-479"><span class="linenos">479</span></a>        <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">neighbors</span> <span class="ow">in</span> <span class="n">later_nbrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Skeleton.mend_breaks-480"><a href="#Skeleton.mend_breaks-480"><span class="linenos">480</span></a>            <span class="c1"># Go over each neighbor</span>
</span><span id="Skeleton.mend_breaks-481"><a href="#Skeleton.mend_breaks-481"><span class="linenos">481</span></a>            <span class="k">for</span> <span class="n">node2</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">:</span>
</span><span id="Skeleton.mend_breaks-482"><a href="#Skeleton.mend_breaks-482"><span class="linenos">482</span></a>                <span class="c1"># Check if there is one or more third nodes that are connected to both</span>
</span><span id="Skeleton.mend_breaks-483"><a href="#Skeleton.mend_breaks-483"><span class="linenos">483</span></a>                <span class="n">third_nodes</span> <span class="o">=</span> <span class="n">neighbors</span> <span class="o">&amp;</span> <span class="n">later_nbrs</span><span class="p">[</span><span class="n">node2</span><span class="p">]</span>
</span><span id="Skeleton.mend_breaks-484"><a href="#Skeleton.mend_breaks-484"><span class="linenos">484</span></a>                <span class="k">for</span> <span class="n">node3</span> <span class="ow">in</span> <span class="n">third_nodes</span><span class="p">:</span>
</span><span id="Skeleton.mend_breaks-485"><a href="#Skeleton.mend_breaks-485"><span class="linenos">485</span></a>                    <span class="c1"># Add triangle (sort to deduplicate)</span>
</span><span id="Skeleton.mend_breaks-486"><a href="#Skeleton.mend_breaks-486"><span class="linenos">486</span></a>                    <span class="n">triangles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">([</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">node3</span><span class="p">])))</span>
</span><span id="Skeleton.mend_breaks-487"><a href="#Skeleton.mend_breaks-487"><span class="linenos">487</span></a>
</span><span id="Skeleton.mend_breaks-488"><a href="#Skeleton.mend_breaks-488"><span class="linenos">488</span></a>        <span class="c1"># Remove longest edge in each triangle</span>
</span><span id="Skeleton.mend_breaks-489"><a href="#Skeleton.mend_breaks-489"><span class="linenos">489</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">triangles</span><span class="p">:</span>
</span><span id="Skeleton.mend_breaks-490"><a href="#Skeleton.mend_breaks-490"><span class="linenos">490</span></a>            <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span> <span class="o">=</span> <span class="n">t</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">t</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Skeleton.mend_breaks-491"><a href="#Skeleton.mend_breaks-491"><span class="linenos">491</span></a>            <span class="c1"># Make sure all edges still exist (we may have already removed edges</span>
</span><span id="Skeleton.mend_breaks-492"><a href="#Skeleton.mend_breaks-492"><span class="linenos">492</span></a>            <span class="c1"># that were part of a previous triangle)</span>
</span><span id="Skeleton.mend_breaks-493"><a href="#Skeleton.mend_breaks-493"><span class="linenos">493</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">G</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">)):</span>
</span><span id="Skeleton.mend_breaks-494"><a href="#Skeleton.mend_breaks-494"><span class="linenos">494</span></a>                <span class="k">continue</span>
</span><span id="Skeleton.mend_breaks-495"><a href="#Skeleton.mend_breaks-495"><span class="linenos">495</span></a>            <span class="c1"># Remove the longest edge</span>
</span><span id="Skeleton.mend_breaks-496"><a href="#Skeleton.mend_breaks-496"><span class="linenos">496</span></a>            <span class="n">G</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="o">*</span><span class="nb">max</span><span class="p">((</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">]))</span>
</span><span id="Skeleton.mend_breaks-497"><a href="#Skeleton.mend_breaks-497"><span class="linenos">497</span></a>
</span><span id="Skeleton.mend_breaks-498"><a href="#Skeleton.mend_breaks-498"><span class="linenos">498</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Mend breaks in the skeleton using the original mesh.</p>

<p>This works by comparing the connectivity of the original mesh with that
of the skeleton. If the shortest path between two adjacent vertices on the mesh
is shorter than the distance between the nodes in the skeleton, a new edge
is added to the skeleton.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dist_mult</strong> (float, optional):
Factor by which the new edge should be shorter than the
current shortest path between two nodes to be added.
Lower values = fewer false negatives; higher values = fewer
false positive edges.</li>
<li><strong>dist_min</strong> (float, optional):
Minimum distance between nodes to consider adding an edge.
Use this to avoid adding very short edges.</li>
<li><strong>dist_max</strong> (float, optional):
Maximum distance between nodes to consider adding an edge.
Use this to avoid adding very long edges.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>edges</strong> ((N, 2) array):
Edges connecting the skeleton nodes.</li>
<li><strong>vertices</strong> ((N, 3) array):
Positions of the skeleton nodes.</li>
</ul>
</div>


                            </div>
                </section>
                <section id="example_mesh">
                            <input id="example_mesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">example_mesh</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="example_mesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#example_mesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="example_mesh-43"><a href="#example_mesh-43"><span class="linenos">43</span></a><span class="k">def</span><span class="w"> </span><span class="nf">example_mesh</span><span class="p">():</span>
</span><span id="example_mesh-44"><a href="#example_mesh-44"><span class="linenos">44</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load and return example mesh.</span>
</span><span id="example_mesh-45"><a href="#example_mesh-45"><span class="linenos">45</span></a>
</span><span id="example_mesh-46"><a href="#example_mesh-46"><span class="linenos">46</span></a><span class="sd">    The example mesh is a fruit fly neuron (an olfactory projection neuron of</span>
</span><span id="example_mesh-47"><a href="#example_mesh-47"><span class="linenos">47</span></a><span class="sd">    the DA1 glomerulus) segmented from an EM image data set. It is part of the</span>
</span><span id="example_mesh-48"><a href="#example_mesh-48"><span class="linenos">48</span></a><span class="sd">    Janelia hemibrain data set (see [here](https://neuprint.janelia.org)) [1].</span>
</span><span id="example_mesh-49"><a href="#example_mesh-49"><span class="linenos">49</span></a>
</span><span id="example_mesh-50"><a href="#example_mesh-50"><span class="linenos">50</span></a><span class="sd">    References</span>
</span><span id="example_mesh-51"><a href="#example_mesh-51"><span class="linenos">51</span></a><span class="sd">    ----------</span>
</span><span id="example_mesh-52"><a href="#example_mesh-52"><span class="linenos">52</span></a><span class="sd">    [1] Louis K. Scheffer et al., eLife. 2020. doi: 10.7554/eLife.57443</span>
</span><span id="example_mesh-53"><a href="#example_mesh-53"><span class="linenos">53</span></a><span class="sd">    A connectome and analysis of the adult Drosophila central brain</span>
</span><span id="example_mesh-54"><a href="#example_mesh-54"><span class="linenos">54</span></a>
</span><span id="example_mesh-55"><a href="#example_mesh-55"><span class="linenos">55</span></a><span class="sd">    Returns</span>
</span><span id="example_mesh-56"><a href="#example_mesh-56"><span class="linenos">56</span></a><span class="sd">    -------</span>
</span><span id="example_mesh-57"><a href="#example_mesh-57"><span class="linenos">57</span></a><span class="sd">    trimesh.Trimesh</span>
</span><span id="example_mesh-58"><a href="#example_mesh-58"><span class="linenos">58</span></a>
</span><span id="example_mesh-59"><a href="#example_mesh-59"><span class="linenos">59</span></a><span class="sd">    Examples</span>
</span><span id="example_mesh-60"><a href="#example_mesh-60"><span class="linenos">60</span></a><span class="sd">    --------</span>
</span><span id="example_mesh-61"><a href="#example_mesh-61"><span class="linenos">61</span></a><span class="sd">    &gt;&gt;&gt; import skeletor as sk</span>
</span><span id="example_mesh-62"><a href="#example_mesh-62"><span class="linenos">62</span></a><span class="sd">    &gt;&gt;&gt; # Load this example mesh</span>
</span><span id="example_mesh-63"><a href="#example_mesh-63"><span class="linenos">63</span></a><span class="sd">    &gt;&gt;&gt; mesh = sk.example_mesh()</span>
</span><span id="example_mesh-64"><a href="#example_mesh-64"><span class="linenos">64</span></a>
</span><span id="example_mesh-65"><a href="#example_mesh-65"><span class="linenos">65</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="example_mesh-66"><a href="#example_mesh-66"><span class="linenos">66</span></a>    <span class="k">return</span> <span class="n">tm</span><span class="o">.</span><span class="n">load_mesh</span><span class="p">(</span><span class="n">obj_path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Load and return example mesh.</p>

<p>The example mesh is a fruit fly neuron (an olfactory projection neuron of
the DA1 glomerulus) segmented from an EM image data set. It is part of the
Janelia hemibrain data set (see <a href="https://neuprint.janelia.org">here</a>) [1].</p>

<h6 id="references">References</h6>

<p>[1] Louis K. Scheffer et al., eLife. 2020. doi: 10.7554/eLife.57443
A connectome and analysis of the adult Drosophila central brain</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>trimesh.Trimesh</strong></li>
</ul>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">skeletor</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sk</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Load this example mesh</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mesh</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">example_mesh</span><span class="p">()</span>
</code></pre>
</div>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>